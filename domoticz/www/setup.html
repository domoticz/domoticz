<div id="dialog-findlatlong" title="Find your Geo location">
    <form>
        <table class="display" id="latlongtable" border="0" cellpadding="0" cellspacing="0">
        <tr>
          <td align="right" style="width:60px"><label for="name">Address: </label></td>
          <td>
						<input type="text" id="address" style="width: 300px; padding: .2em;" class="text ui-widget-content ui-corner-all" /><br>
						(Example: Streetname Number City Country)
          </td>
        </tr>
        <tr>
					<td></td>
					<td><button id="getlatlong">GetLatLong</button></td>
        </tr>
        <tr>
          <td align="right"><label for="lbllat">Latitude: </label></td>
          <td><input type="text" id="latitude" style="width: 90px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
		    </tr>
        <tr>
          <td align="right"><label for="lbllng">Longitude: </label></td>
          <td><input type="text" id="longitude" style="width: 90px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
		    </tr>
		    </table>
    </form>
</div>
<div class="row">
	<div class="span4 hidden-phone">
	   <div class="well sidebar-nav sb-fixed">
			<!-- Sidebar Contents -->
			<ul class="nav nav-list bs-docs-sidenav">
			  <li><a class="sb-link" id="idsystem" onmouseover="cursorhand()" onmouseout="cursordefault()"><i class="icon-chevron-right"></i> System</a></li>
			  <li><a class="sb-link" id="idloghistory" onmouseover="cursorhand()" onmouseout="cursordefault()"><i class="icon-chevron-right"></i> Log History</a></li>
			  <li><a class="sb-link" id="idnotifications" onmouseover="cursorhand()" onmouseout="cursordefault()"><i class="icon-chevron-right"></i> Notificatons</a></li>
			  <li><a class="sb-link" id="idemailsetup" onmouseover="cursorhand()" onmouseout="cursordefault()"><i class="icon-chevron-right"></i> Email Setup</a></li>
			  <li><a class="sb-link" id="idmetercounters" onmouseover="cursorhand()" onmouseout="cursordefault()"><i class="icon-chevron-right"></i> Meter/Counter Setup</a></li>
			  <li><a class="sb-link" id="idothersettings" onmouseover="cursorhand()" onmouseout="cursordefault()"><i class="icon-chevron-right"></i> Other Settings</a></li>
			</ul>
			<center><a class="btn btn-danger" href="javascript:StoreSettings()">Save</a></center>
	   </div>
	</div>

	<div id="settingscontent" class="span8">
		<form id="settings">
		<!-- Location
		================================================== -->
		<section id="system">
			<div class="page-header-small">
				<h1>System Setup</h1>
			</div>
			<h2>Location:</h2>
			<label id="sunriseset"></label>
			<table class="display" id="locationtable" border="0" cellpadding="0" cellspacing="0">
			<tr>
				<td align="right" style="width:60px"><label for="Latitude">Latitude: </label></td>
				<td><input type="text" id="Latitude" name="Latitude" style="width: 150px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
			<tr>
				<td align="right"><label for="Longitude">Longitude: </label></td>
				<td><input type="text" id="Longitude" name="Longitude" style="width: 150px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
			</tr>
			</table>
			To find your location click <a class="norm-link" onclick="GetGeoLocation();" onMouseover="cursorhand()" onMouseout="cursordefault()">Here</a><br>
			<br>
			<h2>Dashboard:</h2>
			<table class="display" id="dashmodetable" border="0" cellpadding="0" cellspacing="0">
			<tr>
				<td align="right" style="width:60px"><label>Mode: </label></td>
				<td><select id="combosdashtype" name="DashboardType" style="width:120px" class="combobox ui-corner-all">
					<option value="0">Normal</option>
					<option value="1">Compact</option>
					<option value="2">Mobile</option>
				</select></td>
			</tr>
			</table>
			<br>
			<h2>Website Protection:</h2>
			<table class="display" id="webtable" border="0" cellpadding="0" cellspacing="0">
			<tr>
				<td align="right" style="width:60px"><label>Username: </label></td>
				<td><input type="input" id="WebUserName" name="WebUserName" style="width: 200px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
			</tr>
			<tr>
				<td align="right" style="width:60px"><label>Password: </label></td>
				<td><input type="password" id="WebPassword" name="WebPassword" style="width: 200px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
			</tr>
			</table>
			<br>
			Local Networks (no username/password):<br><br>
			<table class="display" id="weblocaltable" border="0" cellpadding="0" cellspacing="0">
			<tr>
				<td align="right" style="width:60px"><label>Networks: </label></td>
				<td>
					<input type="input" id="WebLocalNetworks" name="WebLocalNetworks" style="width: 300px; padding: .2em;" class="text ui-widget-content ui-corner-all" /><br>
					(Separate by a semicolon, For Example: 127.0.0.*;192.168.0.*)
				</td>
			</tr>
			</table>
			<br>
			<div id="SoftwareUpdates">
				<h2>Software Updates:</h2>
				<table class="display" id="autoupdatetable" border="0" cellpadding="0" cellspacing="0">
					<tr>
						<td><input type="checkbox" id="checkforupdates" name="checkforupdates"/> Check for Updates (Not working on windows systems)</td>
					</tr>
				</table>
			</div>
		</section>

		<!-- Log History
		================================================== -->
		<section id="loghistory">
		  <div class="page-header-small">
			<h1>Log History</h1>
		  </div>
			<h2>Light/Switches:</h2>
			<table class="display" id="lightlogtable" border="0" cellpadding="0" cellspacing="0">
			<tr>
				<td align="right" style="width:60px"><label>Days: </label></td>
				<td><input type="text" id="LightHistoryDays" name="LightHistoryDays" style="width: 50px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
			</tr>
			</table>
			<br>
			<h2>Short Log Sensors:</h2>
			<table class="display" id="shortlogtable" border="0" cellpadding="0" cellspacing="0">
			<tr>
				<td align="right" style="width:60px"><label>Days: </label></td>
				<td><select id="comboshortlogdays" name="ShortLogDays" style="width:60px" class="combobox ui-corner-all">
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
					<option value="6">6</option>
					<option value="7">7</option>
				</select></td>
			</tr>
			</table>
		</section>

		<!-- Notification system
		================================================== -->
		<section id="notifications">
		  <div class="page-header-small">
			<h1>Notification system</h1>
		  </div>
			<h2>Prowl (iPhone/iPad):</h2>
			<table class="display" id="prowltable" border="0" cellpadding="0" cellspacing="0">
			<tr>
				<td align="right" style="width:60px"><label for="apikey">API Key: </label></td>
				<td><input type="input" id="apikey" name="ProwlAPIKey" style="width: 300px; padding: .2em;" class="text ui-widget-content ui-corner-all" />  <a class="btnstyle3" href="javascript:TestProwlNotification()">Test</a></td>
			</tr>
			</table>
			To get a free account/API key click <a class="norm-link" href="https://www.prowlapp.com/" target="_blank">Here</a><br>
			<br>
			<h2>NMA (Android):</h2>
			<table class="display" id="nmatable" border="0" cellpadding="0" cellspacing="0">
			<tr>
				<td align="right" style="width:60px"><label for="apikey">API Key: </label></td>
				<td><input type="input" id="apikey" name="NMAAPIKey" style="width: 356px; padding: .2em;" class="text ui-widget-content ui-corner-all" />  <a class="btnstyle3" href="javascript:TestNMANotification()">Test</a></td>
			</tr>
			</table>
			To get a free account/API key click <a class="norm-link" href="http://www.notifymyandroid.com/" target="_blank">Here</a><br>
		</section>

		<!-- Email Setup
		================================================== -->
		<section id="emailsetup">
		  <div class="page-header-small">
			<h1>Email Setup</h1>
		  </div>
			<table class="display" id="emailtable" border="0" cellpadding="0" cellspacing="0">
			<tr>
				<td align="right" style="width:60px"><label>From: </label></td>
				<td><input type="input" id="EmailFrom" name="EmailFrom" style="width: 180px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
			</tr>
			<tr>
				<td align="right" style="width:60px"><label>To: </label></td>
				<td><input type="input" id="EmailTo" name="EmailTo" style="width: 300px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
			</tr>
			<tr>
				<td></td>
				<td>(Separate by a semicolon, For Example: user@mail.com;user2@mail.com)</td>
			</tr>
			<tr>
				<td align="right" style="width:60px"><label>Server: </label></td>
				<td><input type="input" id="EmailServer" name="EmailServer" style="width: 200px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
			</tr>
			<tr>
				<td align="right" style="width:60px"><label>Port: </label></td>
				<td><input type="input" id="EmailPort" name="EmailPort" style="width: 40px; padding: .2em;" class="text ui-widget-content ui-corner-all" /> (default 25, StartTLS Port 587, SSL Port 465)</td>
			</tr>
			<tr>
				<td align="right" style="width:60px"><label>Username: </label></td>
				<td><input type="input" id="EmailUsername" name="EmailUsername" style="width: 200px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
			</tr>
			<tr>
				<td align="right" style="width:60px"><label>Password: </label></td>
				<td><input type="password" id="EmailPassword" name="EmailPassword" style="width: 200px; padding: .2em;" class="text ui-widget-content ui-corner-all" />  <a class="btnstyle3" href="javascript:TestEmailNotification()">Test</a></td>
			</tr>
			<tr>
				<td></td>
				<td><input type="checkbox" id="useemailinnotificationsalerts" name="useemailinnotificationsalerts"/> Send Email Notification Alerts</td>
			</tr>
			</table>
		</section>

		<!-- Meter Settings
		================================================== -->
		<section id="metercounters">
		  <div class="page-header-small">
			<h1>Meter/Counter Setup</h1>
		  </div>
			<h2>RFXMeter/Counter Dividers:</h2>
			<table class="display" id="rfxmetertable" border="0" cellpadding="0" cellspacing="0">
			<tr>
				<td align="right" style="width:60px"><label>Energy: </label></td>
				<td><input type="input" id="EnergyDivider" name="EnergyDivider" style="width: 80px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
				<td align="right" style="width:60px"><label>Costs: </label></td>
				<td><input type="input" id="CostEnergy" name="CostEnergy" style="width: 60px; padding: .2em;" class="text ui-widget-content ui-corner-all" /> / kWh</td>
			</tr>
			<tr>
				<td align="right" style="width:60px"><label>Gas: </label></td>
				<td><input type="input" id="GasDivider" name="GasDivider" style="width: 80px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
				<td align="right" style="width:60px"><label>Costs: </label></td>
				<td><input type="input" id="CostGas" name="CostGas" style="width: 60px; padding: .2em;" class="text ui-widget-content ui-corner-all" /> / m3</td>
			</tr>
			<tr>
				<td align="right" style="width:60px"><label>Water: </label></td>
				<td><input type="input" id="WaterDivider" name="WaterDivider" style="width: 80px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
				<td align="right" style="width:60px"><label>Costs: </label></td>
				<td><input type="input" id="CostWater" name="CostWater" style="width: 60px; padding: .2em;" class="text ui-widget-content ui-corner-all" /> / m3</td>
			</tr>
			</table>
			<br>
			<h2>OWL CM113/CM180i:</h2>
			<table class="display" id="owl113table" border="0" cellpadding="0" cellspacing="0">
				<tr>
					<td align="right" style="width:60px"><label>Voltage: </label></td>
					<td><input type="input" id="ElectricVoltage" name="ElectricVoltage" style="width: 40px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
				</tr>
				<tr>
					<td align="right" style="width:60px"><label>Display: </label></td>
					<td><select id="comboscm113type" name="CM113DisplayType" style="width:120px" class="combobox ui-corner-all">
						<option value="0">Ampere</option>
						<option value="1">Watt</option>
					</select></td>
				</tr>
			</table>
		</section>

		<!-- Other Settings
		================================================== -->
		<section id="othersettings">
		  <div class="page-header-small">
			<h1>Other Settings</h1>
		  </div>
			<h2>Random Timer:</h2>
			<table class="display" id="randomtable" border="0" cellpadding="0" cellspacing="0">
			<tr>
				<td align="right" style="width:60px"><label>Spread: </label></td>
				<td><input type="input" id="RandomSpread" name="RandomSpread" style="width: 50px; padding: .2em;" class="text ui-widget-content ui-corner-all" /> (Minutes +/-)</td>
			</tr>
			</table>
		</section>
		<br>
		<section id="savesettings">
			<a class="btn btn-danger" href="javascript:StoreSettings()">Save</a>
		</section>
		<br>
		</form>
	</div>
</div>

<script type="text/javascript" charset="utf-8"> 

var googleMapsCallback;

function GetGeoLocation() {
	googleMapsCallback = function() {
		$( "#dialog-findlatlong" ).dialog( "open" );
  };
  $.ajax({
        url: "https://maps.googleapis.com/maps/api/js?v=3&callback=googleMapsCallback&sensor=false",
        dataType: "script"
  });
}

function TestProwlNotification()
{
  var ProwlAPI=$("#prowltable #apikey").val();
  if (ProwlAPI=="") {
    ShowNotify('Please enter the API key!...', 3500, true);
    return;
  }
  var url="http://api.prowlapp.com/publicapi/add?apikey=" + ProwlAPI + "&priority=0&application=Domoticz&event=Test Message&description=This is a test message!";
  $.get(url, function(data) {
  });  
  ShowNotify('Notification send!<br>Should arrive at your device soon...', 3000);
}

function TestNMANotification()
{
  var NMAAPI=$("#nmatable #apikey").val();
  if (NMAAPI=="") {
    ShowNotify('Please enter the API key!...', 3500, true);
    return;
  }
  var url="http://www.notifymyandroid.com/publicapi/notify?apikey=" + NMAAPI + "&priority=0&application=Domoticz&event=Test Message&description=This is a test message!";
  $.get(url, function(data) {
  });  
  ShowNotify('Notification send!<br>Should arrive at your device soon...', 3000);
}

function TestEmailNotification()
{
	var EmailServer=$("#emailtable #EmailServer").val();
	if (EmailServer=="") {
		ShowNotify('Invalid Email Settings...', 2000, true);
		return;
	}
	var EmailPort=$("#emailtable #EmailPort").val();
	if (EmailPort=="") {
		ShowNotify('Invalid Email Settings...', 2000, true);
		return;
	}
	var EmailFrom=$("#emailtable #EmailFrom").val();
	var EmailTo=$("#emailtable #EmailTo").val();
	var EmailUsername=$("#emailtable #EmailUsername").val();
	var EmailPassword=$("#emailtable #EmailPassword").val();
	if ((EmailFrom=="")||(EmailTo=="")) {
		ShowNotify('Invalid Email From/To Settings...', 2000, true);
		return;
	}
	if ((EmailUsername!="")&&(EmailPassword=="")) {
		ShowNotify('Please enter an Email Password...', 2000, true);
		return;
	}
	$.ajax({
		url: "json.htm?type=command&param=testemail"+
			"&EmailFrom="+EmailFrom+
			"&EmailTo="+EmailTo+
			"&EmailServer="+EmailServer+
			"&EmailPort="+EmailPort+
			"&EmailUsername="+EmailUsername+
			"&EmailPassword="+EmailPassword, 
		async: false, 
		dataType: 'json',
		success: function(data) {
			if (data.status != "OK") {
				HideNotify();
				ShowNotify('Problem sending Email, please check credentials!', 2500, true);
				return;
			}
			else {
				HideNotify();
				ShowNotify('An Email has been delivered<br>Please check your inbox!', 2500);
			}
		},
		error: function(){
			HideNotify();
			ShowNotify('Problem sending Email, please check credentials!', 2500, true);
		}
	});
}

function ShowSettings()
{
  var sunRise="";
  var sunSet="";
  $.ajax({
     url: "json.htm?type=command&param=getSunRiseSet",
     async: false, 
     dataType: 'json',
     success: function(data) {
        if (typeof data.Sunrise != 'undefined') {
          sunRise=data.Sunrise;
          sunSet=data.Sunset;
        }
     }
  });
  
	var suntext="";
  if (sunRise!="")
  {
    suntext='<br>Current SunRise: ' + sunRise + ', SunSet: ' + sunSet + '<br><br>\n';
    $("#sunriseset").html(suntext);
  }
  

  $.ajax({
     url: "json.htm?type=settings", 
     async: false, 
     dataType: 'json',
     success: function(data) {
      if (typeof data.Location != 'undefined') {
        $("#locationtable #Latitude").val(data.Location.Latitude);
        $("#locationtable #Longitude").val(data.Location.Longitude);
      }
      if (typeof data.ProwlAPI != 'undefined') {
        $("#prowltable #apikey").val(data.ProwlAPI);
      }
      if (typeof data.NMAAPI != 'undefined') {
        $("#nmatable #apikey").val(data.NMAAPI);
      }
      if (typeof data.LightHistoryDays != 'undefined') {
        $("#lightlogtable #LightHistoryDays").val(data.LightHistoryDays);
      }
      if (typeof data.ShortLogDays != 'undefined') {
        $("#shortlogtable #comboshortlogdays").val(data.ShortLogDays);
      }
      if (typeof data.DashboardType != 'undefined') {
        $("#dashmodetable #combosdashtype").val(data.DashboardType);
      }
      if (typeof data.WebUserName != 'undefined') {
        $("#webtable #WebUserName").val(data.WebUserName);
      }
      if (typeof data.WebPassword != 'undefined') {
        $("#webtable #WebPassword").val(data.WebPassword);
      }
      if (typeof data.WebLocalNetworks != 'undefined') {
        $("#weblocaltable #WebLocalNetworks").val(data.WebLocalNetworks);
      }
      if (typeof data.EnergyDivider != 'undefined') {
        $("#rfxmetertable #EnergyDivider").val(data.EnergyDivider);
      }
      if (typeof data.CostEnergy != 'undefined') {
        $("#rfxmetertable #CostEnergy").val(data.CostEnergy);
      }
      if (typeof data.GasDivider != 'undefined') {
        $("#rfxmetertable #GasDivider").val(data.GasDivider );
      }
      if (typeof data.CostGas!= 'undefined') {
        $("#rfxmetertable #CostGas").val(data.CostGas);
      }
      if (typeof data.WaterDivider != 'undefined') {
        $("#rfxmetertable #WaterDivider").val(data.WaterDivider );
      }
      if (typeof data.CostWater!= 'undefined') {
        $("#rfxmetertable #CostWater").val(data.CostWater);
      }
      if (typeof data.RandomTimerFrame != 'undefined') {
        $("#randomtable #RandomSpread").val(data.RandomTimerFrame );
      }
      if (typeof data.ElectricVoltage!= 'undefined') {
        $("#owl113table #ElectricVoltage").val(data.ElectricVoltage);
      }
      if (typeof data.CM113DisplayType != 'undefined') {
        $("#owl113table #comboscm113type").val(data.CM113DisplayType);
      }
      if (typeof data.UseAutoUpdate != 'undefined') {
        $("#autoupdatetable #checkforupdates").prop('checked',data.UseAutoUpdate==1);
      }
      if (typeof data.EmailFrom!= 'undefined') {
        $("#emailtable #EmailFrom").val(data.EmailFrom);
      }
      if (typeof data.EmailTo!= 'undefined') {
        $("#emailtable #EmailTo").val(data.EmailTo);
      }
      if (typeof data.EmailServer!= 'undefined') {
        $("#emailtable #EmailServer").val(data.EmailServer);
      }
      if (typeof data.EmailPort!= 'undefined') {
        $("#emailtable #EmailPort").val(data.EmailPort);
      }
      if (typeof data.EmailUsername!= 'undefined') {
        $("#emailtable #EmailUsername").val(data.EmailUsername);
      }
      if (typeof data.EmailPassword!= 'undefined') {
        $("#emailtable #EmailPassword").val(data.EmailPassword);
      }
      if (typeof data.UseEmailInNotifications != 'undefined') {
        $("#emailtable #useemailinnotificationsalerts").prop('checked',data.UseEmailInNotifications==1);
      }
     }
  });

}

function StoreSettings(formname)
{
  var Latitude=$("#locationtable #Latitude").val();
  var Longitude=$("#locationtable #Longitude").val();
  if (
      ((Latitude=="")||(Longitude==""))||
      ( isNaN(Latitude)||isNaN(Longitude) )
    )
  {
    ShowNotify('Invalid Location Settings...', 2000, true);
    return;
  }
  
  //Check email settings
  var EmailServer=$("#emailtable #EmailServer").val();
  if (EmailServer!="")
  {
	var EmailPort=$("#emailtable #EmailPort").val();
	if (EmailPort=="") {
		ShowNotify('Please enter an Email Port...', 2000, true);
		return;
	}
	var EmailFrom=$("#emailtable #EmailFrom").val();
	var EmailTo=$("#emailtable #EmailTo").val();
	var EmailUsername=$("#emailtable #EmailUsername").val();
	var EmailPassword=$("#emailtable #EmailPassword").val();
	if ((EmailFrom=="")||(EmailTo=="")) {
		ShowNotify('Invalid Email From/To Settings...', 2000, true);
		return;
	}
	if ((EmailUsername!="")&&(EmailPassword=="")) {
		ShowNotify('Please enter an Email Password...', 2000, true);
		return;
	}
  }
  
  $.post("storesettings.webem", $("#settings").serialize(), function(data) {
   SwitchLayout('Dashboard');
  });
}

function MakeScrollLink(nameclick,namescroll)
{
	$(nameclick).click(function(e){
		var position = $(namescroll).offset();
		scroll(0,position.top-60);
		e.preventDefault();
    });
}

$(document).ready(function() {
  MakeScrollLink("#idsystem","#system");
  MakeScrollLink("#idloghistory","#loghistory");
  MakeScrollLink("#idnotifications","#notifications");
  MakeScrollLink("#idemailsetup","#emailsetup");
  MakeScrollLink("#idmetercounters","#metercounters");
  MakeScrollLink("#idothersettings","#othersettings");
  
    $( "#dialog-findlatlong" ).dialog({
          autoOpen: false,
          width: 480,
          height: 280,
          modal: true,
          resizable: false,
          buttons: {
              "OK": function() {
                  var bValid = true;
                  bValid = bValid && checkLength( $("#dialog-findlatlong #latitude"), 3, 100 );
                  bValid = bValid && checkLength( $("#dialog-findlatlong #longitude"), 3, 100 );
                  if ( bValid ) {

											$("#locationtable #Latitude").val($( '#dialog-findlatlong #latitude' ).val());
											$("#locationtable #Longitude").val($( '#dialog-findlatlong #longitude' ).val());
                  
                      $( this ).dialog( "close" );
                  } else
                  {
										alert('Please enter a Latitude and Longitude!...', 3500, true);
                  }
              },
              Cancel: function() {
                  $( this ).dialog( "close" );
              }
          },
          open: function() {
              $(this).keypress(function(e) {
                if (e.keyCode == $.ui.keyCode.ENTER) {
                  e.preventDefault();
                  $(this).parent().find("button:eq(0)").trigger("click");
                }
              });
							$( '#getlatlong' ).click( function()
							{
									var address = $( '#dialog-findlatlong #address' ).val();
									if (address=="")
									{
										alert('Please enter a Address to search for!...', 3500, true);
										return false;
									}
									geocoder = new google.maps.Geocoder();
									geocoder.geocode( { 'address': address}, function(results, status) {
										if (status == google.maps.GeocoderStatus.OK) {
												$( '#dialog-findlatlong #latitude' ).val(results[0].geometry.location.lat().toFixed(6));
												$( '#dialog-findlatlong #longitude' ).val(results[0].geometry.location.lng().toFixed(6));
										} else {
											alert('Geocode was not successful for the following reason: ' + status);
										}
									});
									return false;
							} );              
          },
          close: function() {
            $( this ).dialog( "close" );
          }
    });
  
	ShowSettings();
} );   

</script>