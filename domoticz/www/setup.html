<div id="dialog-findlatlong" title="Find your Geo location">
    <form>
    <fieldset>
        <table class="display" id="latlongtable" border="0" cellpadding="0" cellspacing="0">
        <tr>
          <td align="right" style="width:60px"><label for="name">Address: </label></td>
          <td>
						<input type="text" id="address" style="width: 300px; padding: .2em;" class="text ui-widget-content ui-corner-all" /><br>
						(Example: Streetname Number City Country)
          </td>
        </tr>
        <tr>
					<td></td>
					<td><button id="getlatlong">GetLatLong</button></td>
        </tr>
        <tr>
          <td align="right"><label for="lbllat">Latitude: </label></td>
          <td><input type="text" id="latitude" style="width: 90px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
		    </tr>
        <tr>
          <td align="right"><label for="lbllng">Longitude: </label></td>
          <td><input type="text" id="longitude" style="width: 90px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
		    </tr>
		    </table>
    </fieldset>
    </form>
</div>
<form id="settings">
<div class="row divider borderbot">
	<div class="6u">
	<h2>Location:</h2><br>
	<label id="sunriseset"></label>
	<table class="display" id="locationtable" border="0" cellpadding="0" cellspacing="0">
	<tr>
		<td align="right" style="width:60px"><label for="Latitude">Latitude: </label></td>
		<td><input type="text" id="Latitude" name="Latitude" style="width: 150px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
	<tr>
		<td align="right"><label for="Longitude">Longitude: </label></td>
		<td><input type="text" id="Longitude" name="Longitude" style="width: 150px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
	</tr>
	</table>
	To find your location click <a onclick="GetGeoLocation();" onMouseover="cursorhand()" onMouseout="cursordefault()">Here</a><br>
	</div>
</div>
<br>
<div class="row divider borderbot">
	<div class="6u">
	<h2>Prowl (iPhone/iPad notification system):</h2><br>
	<table class="display" id="prowltable" border="0" cellpadding="0" cellspacing="0">
	<tr>
		<td align="right" style="width:60px"><label for="apikey">API Key: </label></td>
		<td><input type="input" id="apikey" name="ProwlAPIKey" style="width: 300px; padding: .2em;" class="text ui-widget-content ui-corner-all" />  <a class="btnstyle3" href="javascript:TestProwlNotification()">Test</a></td>
	</tr>
	</table>
	To get a free account/API key click <a href="https://www.prowlapp.com" target="_blank">Here</a><br>
	</div>
	<div class="6u">
	<h2>NMA (Android notification system):</h2><br>
	<table class="display" id="nmatable" border="0" cellpadding="0" cellspacing="0">
	<tr>
		<td align="right" style="width:60px"><label for="apikey">API Key: </label></td>
		<td><input type="input" id="apikey" name="NMAAPIKey" style="width: 356px; padding: .2em;" class="text ui-widget-content ui-corner-all" />  <a class="btnstyle3" href="javascript:TestNMANotification()">Test</a></td>
	</tr>
	</table>
	To get a free account/API key click <a href="http://www.notifymyandroid.com/" target="_blank">Here</a><br>
	</div>
</div>
<br>
<div class="row divider borderbot">
	<div class="6u">
	<h2>Light/Switch History:</h2><br>
	<table class="display" id="lightlogtable" border="0" cellpadding="0" cellspacing="0">
	<tr>
		<td align="right" style="width:60px"><label>Days: </label></td>
		<td><input type="text" id="LightHistoryDays" name="LightHistoryDays" style="width: 50px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
	</tr>
	</table>
	</div>
	<div class="6u">
	<h2>Dashboard:</h2><br>
	<table class="display" id="dashmodetable" border="0" cellpadding="0" cellspacing="0">
	<tr>
		<td align="right" style="width:60px"><label>Mode: </label></td>
		<td><select id="combosdashtype" name="DashboardType" style="width:120px" class="combobox ui-corner-all">
			<option value="0">Normal</option>
			<option value="1">Compact</option>
			<option value="2">Mobile</option>
		</select></td>
	</tr>
	</table>
	</div>
</div>
<br>
<div class="row divider borderbot">
	<div class="6u">
	<h2>Website Protection:</h2><br>
	<table class="display" id="webtable" border="0" cellpadding="0" cellspacing="0">
	<tr>
		<td align="right" style="width:60px"><label>Username: </label></td>
		<td><input type="input" id="WebUserName" name="WebUserName" style="width: 200px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
	</tr>
	<tr>
		<td align="right" style="width:60px"><label>Password: </label></td>
		<td><input type="password" id="WebPassword" name="WebPassword" style="width: 200px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
	</tr>
	</table>
	<br>
	Local Networks (no username/password):<br><br>
	<table class="display" id="weblocaltable" border="0" cellpadding="0" cellspacing="0">
	<tr>
		<td align="right" style="width:60px"><label>Networks: </label></td>
		<td>
			<input type="input" id="WebLocalNetworks" name="WebLocalNetworks" style="width: 300px; padding: .2em;" class="text ui-widget-content ui-corner-all" /><br>
			(Separate by a semicolon, For Example: 127.0.0.*;192.168.0.*)
		</td>
	</tr>
	</table>
	<br>
	</div>
	<div class="6u">
	<h2>RFXMeter/Counter Dividers:</h2><br>
	<table class="display" id="rfxmetertable" border="0" cellpadding="0" cellspacing="0">
	<tr>
		<td align="right" style="width:60px"><label>Energy: </label></td>
		<td><input type="input" id="EnergyDivider" name="EnergyDivider" style="width: 80px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
	</tr>
	<tr>
		<td align="right" style="width:60px"><label>Gas: </label></td>
		<td><input type="input" id="GasDivider" name="GasDivider" style="width: 80px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
	</tr>
	<tr>
		<td align="right" style="width:60px"><label>Water: </label></td>
		<td><input type="input" id="WaterDivider" name="WaterDivider" style="width: 80px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
	</tr>
	</table>
	</div>
	<div class="6u">
	<h2>Random Timer:</h2><br>
	<table class="display" id="randomtable" border="0" cellpadding="0" cellspacing="0">
	<tr>
		<td align="right" style="width:60px"><label>Spread: </label></td>
		<td><input type="input" id="RandomSpread" name="RandomSpread" style="width: 50px; padding: .2em;" class="text ui-widget-content ui-corner-all" /> (Minutes +/-)</td>
	</tr>
	</table>
	</div>
</div>
<div class="row divider">
	<div class="6u">
	<h2>OWL CM113:</h2><br>
		<table class="display" id="owl113table" border="0" cellpadding="0" cellspacing="0">
			<tr>
				<td align="right" style="width:60px"><label>Voltage: </label></td>
				<td><input type="input" id="ElectricVoltage" name="ElectricVoltage" style="width: 40px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
			</tr>
			<tr>
				<td align="right" style="width:60px"><label>Display: </label></td>
				<td><select id="comboscm113type" name="CM113DisplayType" style="width:120px" class="combobox ui-corner-all">
					<option value="0">Ampere</option>
					<option value="1">Watt</option>
				</select></td>
			</tr>
		</table>
	</tr>
	</div>
	<div class="6u">
	</div>
</div>
<br>
<a class="btnstyle3" href="javascript:StoreSettings()">Save</a>
</form>

<script type="text/javascript" charset="utf-8">

var googleMapsCallback;

function GetGeoLocation() {
	googleMapsCallback = function() {
		$( "#dialog-findlatlong" ).dialog( "open" );
  };
  $.ajax({
        url: "https://maps.googleapis.com/maps/api/js?v=3&callback=googleMapsCallback&sensor=false",
        dataType: "script"
  });
}

function TestProwlNotification()
{
  var ProwlAPI=$("#prowltable #apikey").val();
  if (ProwlAPI=="") {
    ShowNotify('Please enter the API key!...', 3500, true);
    return;
  }
  var url="http://api.prowlapp.com/publicapi/add?apikey=" + ProwlAPI + "&priority=0&application=Domoticz&event=Test Message&description=This is a test message!";
  $.get(url, function(data) {
  });  
  ShowNotify('Notification send!<br>Should arrive at your device soon...', 3000);
}

function TestNMANotification()
{
  var NMAAPI=$("#nmatable #apikey").val();
  if (NMAAPI=="") {
    ShowNotify('Please enter the API key!...', 3500, true);
    return;
  }
  var url="http://www.notifymyandroid.com/publicapi/notify?apikey=" + NMAAPI + "&priority=0&application=Domoticz&event=Test Message&description=This is a test message!";
  $.get(url, function(data) {
  });  
  ShowNotify('Notification send!<br>Should arrive at your device soon...', 3000);
}

function ShowSettings()
{
  var sunRise="";
  var sunSet="";
  $.ajax({
     url: "json.htm?type=command&param=getSunRiseSet",
     async: false, 
     dataType: 'json',
     success: function(data) {
        if (typeof data.Sunrise != 'undefined') {
          sunRise=data.Sunrise;
          sunSet=data.Sunset;
        }
     }
  });
  
	var suntext="";
  if (sunRise!="")
  {
    suntext='<br>Current SunRise: ' + sunRise + ', SunSet: ' + sunSet + '<br><br>\n';
    $("#sunriseset").html(suntext);
  }
  

  $.ajax({
     url: "json.htm?type=settings", 
     async: false, 
     dataType: 'json',
     success: function(data) {
      if (typeof data.Location != 'undefined') {
        $("#locationtable #Latitude").val(data.Location.Latitude);
        $("#locationtable #Longitude").val(data.Location.Longitude);
      }
      if (typeof data.ProwlAPI != 'undefined') {
        $("#prowltable #apikey").val(data.ProwlAPI);
      }
      if (typeof data.NMAAPI != 'undefined') {
        $("#nmatable #apikey").val(data.NMAAPI);
      }
      if (typeof data.LightHistoryDays != 'undefined') {
        $("#lightlogtable #LightHistoryDays").val(data.LightHistoryDays);
      }
      if (typeof data.DashboardType != 'undefined') {
        $("#dashmodetable #combosdashtype").val(data.DashboardType);
      }
      if (typeof data.WebUserName != 'undefined') {
        $("#webtable #WebUserName").val(data.WebUserName);
      }
      if (typeof data.WebPassword != 'undefined') {
        $("#webtable #WebPassword").val(data.WebPassword);
      }
      if (typeof data.WebLocalNetworks != 'undefined') {
        $("#weblocaltable #WebLocalNetworks").val(data.WebLocalNetworks);
      }
      if (typeof data.EnergyDivider != 'undefined') {
        $("#rfxmetertable #EnergyDivider").val(data.EnergyDivider);
      }
      if (typeof data.GasDivider != 'undefined') {
        $("#rfxmetertable #GasDivider").val(data.GasDivider );
      }
      if (typeof data.WaterDivider != 'undefined') {
        $("#rfxmetertable #WaterDivider").val(data.WaterDivider );
      }
      if (typeof data.RandomTimerFrame != 'undefined') {
        $("#randomtable #RandomSpread").val(data.RandomTimerFrame );
      }
      if (typeof data.ElectricVoltage!= 'undefined') {
        $("#owl113table #ElectricVoltage").val(data.ElectricVoltage);
      }
      if (typeof data.CM113DisplayType != 'undefined') {
        $("#owl113table #comboscm113type").val(data.CM113DisplayType);
      }
     }
  });

}

function StoreSettings(formname)
{
  var Latitude=$("#locationtable #Latitude").val();
  var Longitude=$("#locationtable #Longitude").val();
  if (
      ((Latitude=="")||(Longitude==""))||
      ( isNaN(Latitude)||isNaN(Longitude) )
    )
  {
    ShowNotify('Invalid Location Settings...', 2000, true);
    return;
  }
  $.post("storesettings.webem", $("#settings").serialize(), function(data) {
   SwitchLayout('Dashboard');
  });
}

$(document).ready(function() {
    $( "#dialog-findlatlong" ).dialog({
          autoOpen: false,
          width: 480,
          height: 280,
          modal: true,
          resizable: false,
          buttons: {
              "OK": function() {
                  var bValid = true;
                  bValid = bValid && checkLength( $("#dialog-findlatlong #latitude"), 3, 100 );
                  bValid = bValid && checkLength( $("#dialog-findlatlong #longitude"), 3, 100 );
                  if ( bValid ) {

											$("#locationtable #Latitude").val($( '#dialog-findlatlong #latitude' ).val());
											$("#locationtable #Longitude").val($( '#dialog-findlatlong #longitude' ).val());
                  
                      $( this ).dialog( "close" );
                  } else
                  {
										alert('Please enter a Latitude and Longitude!...', 3500, true);
                  }
              },
              Cancel: function() {
                  $( this ).dialog( "close" );
              }
          },
          open: function() {
              $(this).keypress(function(e) {
                if (e.keyCode == $.ui.keyCode.ENTER) {
                  e.preventDefault();
                  $(this).parent().find("button:eq(0)").trigger("click");
                }
              });
							$( '#getlatlong' ).click( function()
							{
									var address = $( '#dialog-findlatlong #address' ).val();
									if (address=="")
									{
										alert('Please enter a Address to search for!...', 3500, true);
										return false;
									}
									geocoder = new google.maps.Geocoder();
									geocoder.geocode( { 'address': address}, function(results, status) {
										if (status == google.maps.GeocoderStatus.OK) {
												$( '#dialog-findlatlong #latitude' ).val(results[0].geometry.location.lat().toFixed(6));
												$( '#dialog-findlatlong #longitude' ).val(results[0].geometry.location.lng().toFixed(6));
										} else {
											alert('Geocode was not successful for the following reason: ' + status);
										}
									});
									return false;
							} );              
          },
          close: function() {
            $( this ).dialog( "close" );
          }
    });

  ShowSettings();
} );  
</script>
