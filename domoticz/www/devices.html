<div id="dialog-adddevice" title="Add Device">
    <form>
    <fieldset>
        <label for="name">Name: </label>
        <input type="text" id="devicename" style="width: 250px; padding: .4em;" class="text ui-widget-content ui-corner-all" />
    </fieldset>
    </form>
</div>
        <table class="bannav" id="bannav" border="0" cellpadding="0" cellspacing="0" width="100%">
        <tr>
          <td align="Left" width="100px">
            <a id="mUsed" class="btnstyle3" href="#" onclick="ShowDevices('used');">Used</a>
          </td>
          <td align="center">
            <a id="mAll" class="btnstyle3-sel" href="#" onclick="ShowDevices('all');">All Devices</a>
          </td>
          <td align="right" width="100px">
            <a id="mUnknown" class="btnstyle3" href="#" onclick="ShowDevices('unknown');">Not Used</a>
          </td>
        </tr>
        </table>
        <br>
        <table class="display" id="devices" border="0" cellpadding="0" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th width="20"></th>
                    <th width="100" align="left">Hardware</th>
                    <th width="80" align="left">ID</th>
                    <th width="80" align="center">Unit</th>
                    <th width="200" align="left">Name</th>
                    <th width="150">Type</th>
                    <th width="80">SubType</th>
                    <th>Data</th>
                    <th width="20"></th>
                    <th width="140" align="left">Last Seen</th>
                </tr>
            </thead>
        </table>
<script type="text/javascript" charset="utf-8">

function AddDevice(idx)
{
    $.devIdx = idx;
    $( "#dialog-adddevice" ).dialog( "open" );
}

function DeleteDevice(idx)
{
  if (confirm("Are you sure to remove this Device?")==false)
    return;
    $.ajax({
       url: "json.htm?type=setused&idx=" + idx + '&used=false',
       async: false, 
       dataType: 'json',
       success: function(data) {
          ShowDevices();
       }
    });
    
}

function ShowDevices(filter)
{
  $('#modal').show();
  
    ChangeClass("mUsed","btnstyle3");
    ChangeClass("mAll","btnstyle3");
    ChangeClass("mUnknown","btnstyle3");
  
  var ifilter="all";
  if (typeof filter != 'undefined') {
    if (filter == "used") {
      ifilter = "true";
      ChangeClass("mUsed","btnstyle3-sel");
    }
    else if (filter == "unknown") {
      ChangeClass("mUnknown","btnstyle3-sel");
      ifilter = "false";
    }
    else if (filter == "all") {
      ChangeClass("mAll","btnstyle3-sel");
      ifilter = "all";
    }
  }
  else {
      ChangeClass("mAll","btnstyle3-sel");
  }
  
  var oTable = $('#devices').dataTable();
  oTable.fnClearTable();
  
  $.ajax({
     url: "json.htm?type=devices&used=" + ifilter, 
     async: false, 
     dataType: 'json',
     success: function(data) {
      if (typeof data.result != 'undefined') {
        $.each(data.result, function(i,item){
          var itemAddDelete="";
          if (item.Used!=0) {
            itemAddDelete='<img src="images/delete.png" title="Delete Device" onclick="DeleteDevice(' + item.idx +')">';
          }
          else {
            itemAddDelete='<img src="images/add.png" title="Add Device" onclick="AddDevice(' + item.idx +')">';
          }
          var addId = oTable.fnAddData([
                      '<img src="images/' + item.TypeImg + '.png">',
                      item.HardwareName,
                      item.ID,
                      item.Unit,
                      item.Name,
                      item.Type,
                      item.SubType,
                      item.Data,
                      itemAddDelete,
                      item.LastUpdate
                    ]);
        });
      }
     }
  });
  $('#modal').hide();
  return false;
}

$(document).ready(function() {
    //global var
    $.devIdx=0;

				$('#devices').dataTable( {
					"sDom": '<"H"lfrC>t<"F"ip>',
					"oTableTools": {
						"sRowSelect": "single",
					},
					"aoColumnDefs": [
            { "bSortable": false, "aTargets": [ 0,7 ] }
          ],
          "aaSorting": [[ 8, "desc" ]],
          "bSortClasses": false,
          "bProcessing": true,
					"bStateSave": true,
					"bJQueryUI": true,
					"aLengthMenu": [[25, 50, 100, -1], [25, 50, 100, "All"]],
					"iDisplayLength" : 25,
					"sPaginationType": "full_numbers"
				} );
				
        $( "#dialog-adddevice" ).dialog({
              autoOpen: false,
              width: 350,
              height: 150,
              modal: true,
              resizable: false,
              buttons: {
                  "Add Device": function() {
                      var bValid = true;
                      bValid = bValid && checkLength( $("#dialog-adddevice #devicename"), 3, 100 );
                      if ( bValid ) {
                          $( this ).dialog( "close" );
                          $.ajax({
                             url: "json.htm?type=setused&idx=" + $.devIdx + '&name=' + $("#dialog-adddevice #devicename").val() + '&used=true',
                             async: false, 
                             dataType: 'json',
                             success: function(data) {
                                ShowDevices();
                             }
                          });
                          
                      }
                  },
                  Cancel: function() {
                      $( this ).dialog( "close" );
                  }
              },
              open: function() {
                  $(this).keypress(function(e) {
                    if (e.keyCode == $.ui.keyCode.ENTER) {
                      e.preventDefault();
                      $(this).parent().find("button:eq(0)").trigger("click");
                    }
                  });
              },
              close: function() {
                $( this ).dialog( "close" );
              }
        });
				
				ShowDevices();
} );  
</script>