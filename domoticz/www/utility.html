<div id="dialog-editutilitydevice" title="Edit Device">
    <form>
        <label for="name">Name: </label>
        <input type="text" id="devicename" style="width: 250px; padding: .4em;" class="text ui-widget-content ui-corner-all" />
    </form>
</div>
<div id="dialog-editmeterdevice" title="Edit Meter Device">
    <form>
        <table class="display" id="metertable" border="0" cellpadding="0" cellspacing="0">
        <tr>
          <td align="right" style="width:60px"><label for="name">Name: </label></td>
          <td><input type="text" id="devicename" style="width: 250px; padding: .4em;" class="text ui-widget-content ui-corner-all" /></td>
        <tr>
          <td align="right"><label for="metertype">Type: </label></td>
          <td><select id="combometertype" style="width:150px" class="combobox ui-corner-all">
            <!--#embed metertypes -->
          </select></td>
		    </tr>
		    </table>
    </form>
</div>
<div id="dialog-editsetpointdevice" title="Edit Meter Device">
    <form>
        <table class="display" id="metertable" border="0" cellpadding="0" cellspacing="0">
        <tr>
          <td align="right" style="width:60px"><label for="name">Name: </label></td>
          <td><input type="text" id="devicename" style="width: 250px; padding: .4em;" class="text ui-widget-content ui-corner-all" /></td>
        <tr>
          <td align="right"><label>Value: </label></td>
          <td><input type="text" id="setpoint" style="width: 50px; padding: .4em;" class="text ui-widget-content ui-corner-all" /> &deg; C</td>
		</tr>
		</table>
    </form>
</div>

<div id="utilitycontent">
</div>

<div id="toptextmonthgas" style="display:none;">
    <a class="btnstylerev" onclick="ShowP1YearReportGas(0)" data-i18n="Back">Back</a>&nbsp;
    <h1 id="theader">Usage this Month</h1>
	<br>
	<span>Total Usage:</span> <span id="tu">-</span> <span id="munit">m3</span><br>
	<span>Montly Cost:</span> <span id="mc">-</span><br>
	<br>
</div>
<div id="toptextyeargas" style="display:none;">
	<table class="display" border="0" cellpadding="0" cellspacing="0">
	<tr>
	  <td align="left">
		<a class="btnstylerev" onclick="ShowUtilities()" data-i18n="Back">Back</a>&nbsp;
		<h1 id="theader">Usage this Year</h1>
	  </td>
	  <td align="right">
			<span data-i18n="Year">Year</span>:
			<select id="comboyear" style="width:60px" class="combobox ui-corner-all">
				<option value="2013">2013</option>
				<option value="2014">2014</option>
				<option value="2015">2015</option>
				<option value="2016">2016</option>
				<option value="2017">2017</option>
				<option value="2018">2018</option>
			</select>
	  </td>
	</tr>
	</table>
	<br>
	<span>Total Usage:</span> <span id="tu">-</span> <span id="munit">m3</span><br>
	<span>Year Cost:</span> <span id="mc">-</span><br>
	<br>
</div>

<div id="monthreportviewgas" style="display:none;">
	<table class="display myrighttable" id="monthreport" border="0" cellpadding="0" cellspacing="0" width="100%">
		<thead>
			<tr valign="middle">
				<th width="30" align="right" data-i18n="Day">Day</th>
				<th width="60" align="right">Usage</th>
				<th width="60" align="right">Costs</th>
				<th width="40" align="right"><></th>
			</tr>
		</thead>
	</table>
</div>
<div id="yearreportviewgas" style="display:none;">
	<table class="display myrighttable" id="yearreport" border="0" cellpadding="0" cellspacing="0" width="100%">
		<thead>
			<tr valign="middle">
				<th width="30" align="right">Month</th>
				<th width="60" align="right">Usage</th>
				<th width="60" align="right">Costs</th>
				<th width="40" align="right"><></th>
			</tr>
		</thead>
	</table>
</div>
<div id="toptextmonth" style="display:none;">
    <a class="btnstylerev" onclick="ShowP1YearReport(0)" data-i18n="Back">Back</a>&nbsp;
    <h1 id="theader">Usage this Month</h1>
	<br>
	<span>Total Usage:</span> <span>T1:</span> <span id="tut1">-</span> kWh, <span>T2:</span> <span id="tut2">-</span> kWh, <span>Total:</span> <span id="tu">-</span> kWh<br>
	<div id="dreturn" style="display:none;"><span>Total Return:</span> <span>T1:</span> <span id="trt1">-</span> kWh, <span>T2:</span> <span id="trt2">-</span> kWh, <span>Total:</span> <span id="tr">-</span> kWh<br></div>
	<span>Montly Cost:</span> <span id="mc">-</span><br>
	<br>
</div>
<div id="toptextyear" style="display:none;">
	<table class="display" border="0" cellpadding="0" cellspacing="0">
	<tr>
	  <td align="left">
		<a class="btnstylerev" onclick="ShowUtilities()" data-i18n="Back">Back</a>&nbsp;
		<h1 id="theader">Usage this Year</h1>
	  </td>
	  <td align="right">
			<span data-i18n="Year">Year</span>:
			<select id="comboyear" style="width:74px" class="combobox ui-corner-all">
				<option value="2013">2013</option>
				<option value="2014">2014</option>
				<option value="2015">2015</option>
				<option value="2016">2016</option>
				<option value="2017">2017</option>
				<option value="2018">2018</option>
			</select>
	  </td>
	</tr>
	</table>
	<br>
	<span>Total Usage:</span> <span>T1:</span> <span id="tut1">-</span> kWh, <span>T2:</span> <span id="tut2">-</span> kWh, <span>Total:</span> <span id="tu">-</span> kWh<br>
	<div id="dreturn" style="display:none;"><span>Total Return:</span> <span>T1:</span> <span id="trt1">-</span> kWh, <span>T2:</span> <span id="trt2">-</span> kWh, <span>Total:</span> <span id="tr">-</span> kWh<br></div>
	<span>Year Cost:</span> <span id="mc">-</span><br>
	<br>
</div>
<div id="monthreportview" style="display:none;">
	<table class="display myrighttable" id="monthreport" border="0" cellpadding="0" cellspacing="0" width="100%">
		<thead>
			<tr valign="middle">
				<th width="30" align="right" data-i18n="Day">Day</th>
				<th width="60" align="right">Usage T1</th>
				<th width="60" align="right">Costs</th>
				<th width="60" align="right">Usage T2</th>
				<th width="60" align="right">Costs</th>
				<th width="60" align="right">Return T1</th>
				<th width="60" align="right">Costs</th>
				<th width="60" align="right">Return T2</th>
				<th width="60" align="right">Costs</th>
				<th width="60" align="right">Total</th>
				<th width="40" align="right"><></th>
			</tr>
		</thead>
	</table>
</div>
<div id="yearreportview" style="display:none;">
	<table class="display myrighttable" id="yearreport" border="0" cellpadding="0" cellspacing="0" width="100%">
		<thead>
			<tr valign="middle">
				<th width="30" align="right">Month</th>
				<th width="60" align="right">Usage T1</th>
				<th width="60" align="right">Costs</th>
				<th width="60" align="right">Usage T2</th>
				<th width="60" align="right">Costs</th>
				<th width="60" align="right">Return T1</th>
				<th width="60" align="right">Costs</th>
				<th width="60" align="right">Return T2</th>
				<th width="60" align="right">Costs</th>
				<th width="60" align="right">Total</th>
				<th width="40" align="right"><></th>
			</tr>
		</thead>
	</table>
</div>

<div id="counterlog" style="display:none;">
  <h2 data-i18n="Day">Day</h2>
  <div id="counterdaygraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Week">Week</h2>
  <div id="counterweekgraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Month">Month</h2>
  <div id="countermonthgraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Year">Year</h2>
  <div id="counteryeargraph" style="height: 300px;"></div>
</div>

<div id="airlog" style="display:none;">
  <h2 data-i18n="Day">Day</h2>
  <div id="airdaygraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Month">Month</h2>
  <div id="airmonthgraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Year">Year</h2>
  <div id="airyeargraph" style="height: 300px;"></div>
</div>

<div id="percentagelog" style="display:none;">
  <h2 data-i18n="Day">Day</h2>
  <div id="percentagedaygraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Month">Month</h2>
  <div id="percentagemonthgraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Year">Year</h2>
  <div id="percentageyeargraph" style="height: 300px;"></div>
</div>

<div id="luxlog" style="display:none;">
  <h2 data-i18n="Day">Day</h2>
  <div id="luxdaygraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Month">Month</h2>
  <div id="luxmonthgraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Year">Year</h2>
  <div id="luxyeargraph" style="height: 300px;"></div>
</div>

<div id="usagelog" style="display:none;">
  <h2 data-i18n="Day">Day</h2>
  <div id="usagedaygraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Month">Month</h2>
  <div id="usagemonthgraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Year">Year</h2>
  <div id="usageyeargraph" style="height: 300px;"></div>
</div>

<div id="currentlog" style="display:none;">
  <h2 data-i18n="Day">Day</h2>
  <div id="currentdaygraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Month">Month</h2>
  <div id="currentmonthgraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Year">Year</h2>
  <div id="currentyeargraph" style="height: 300px;"></div>
</div>

<div id="smartlog" style="display:none;">
  <h2 data-i18n="Day">Day</h2>
  <div id="smartdaygraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Week">Week</h2>
  <div id="smartweekgraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Month">Month</h2>
  <div id="smartmonthgraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Year">Year</h2>
  <div id="smartyeargraph" style="height: 300px;"></div>
</div>

<div id="genericlog" style="display:none;">
  <h2 data-i18n="Day">Day</h2>
  <div id="genericdaygraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Week">Week</h2>
  <div id="genericweekgraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Month">Month</h2>
  <div id="genericmonthgraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Year">Year</h2>
  <div id="genericyeargraph" style="height: 300px;"></div>
</div>

<script type="text/javascript" charset="utf-8">

function MakeFavorite(id,isfavorite)
{
	if (window.my_config.userrights!=2) {
        HideNotify();
		ShowNotify($.i18n('You do not have permission to do that!'), 2500, true);
		return;
	}

	clearInterval($.myglobals.refreshTimer);
  $.ajax({
     url: "json.htm?type=command&param=makefavorite&idx=" + id + "&isfavorite=" + isfavorite, 
     async: false, 
     dataType: 'json',
     success: function(data) {
      ShowUtilities();
     }
  });
}

function EditUtilityDevice(idx,name)
{
	clearInterval($.myglobals.refreshTimer);
  $.devIdx=idx;
  $("#dialog-editutilitydevice #devicename").val(name);
  $( "#dialog-editutilitydevice" ).dialog( "open" );
}

function EditMeterDevice(idx,name,switchtype)
{
	clearInterval($.myglobals.refreshTimer);
  $.devIdx=idx;
  $("#dialog-editmeterdevice #devicename").val(name);
  $("#dialog-editmeterdevice #combometertype").val(switchtype);
  $("#dialog-editmeterdevice" ).dialog( "open" );
}

function EditSetPoint(idx,name,setpoint)
{
	clearInterval($.myglobals.refreshTimer);
	$.devIdx=idx;
	$("#dialog-editsetpointdevice #devicename").val(name);
	$("#dialog-editsetpointdevice #setpoint").val(setpoint);
	$("#dialog-editsetpointdevice" ).dialog( "open" );
}

function AddUtilityDevice()
{
  alert($.i18n('Please use the devices tab for this.'));
}

function AddDataToUtilityChart(data,chart,switchtype)
{
    var datatableUsage1 = [];
    var datatableUsage2 = [];
    var datatableReturn1 = [];
    var datatableReturn2 = [];
    var datatableTotalUsage = [];
    var datatableTotalReturn = [];

	var bHaveDelivered=(typeof data.delivered!= 'undefined');
	
    $.each(data.result, function(i,item)
    {
			if (chart == $.DayChart) {
				var cdate=GetUTCFromString(item.d);
				datatableUsage1.push( [cdate, parseFloat(item.v) ] );
				if (typeof item.v2!= 'undefined') {
					datatableUsage2.push( [cdate, parseFloat(item.v2) ] );
				}
				if (bHaveDelivered) {
					datatableReturn1.push( [cdate, parseFloat(item.r1) ] );
					if (typeof item.r2!= 'undefined') {
						datatableReturn2.push( [cdate, parseFloat(item.r2) ] );
					}
				}
			}
			else {
				var cdate=GetDateFromString(item.d);
				datatableUsage1.push( [cdate, parseFloat(item.v) ] );
				if (typeof item.v2!= 'undefined') {
					datatableUsage2.push( [cdate, parseFloat(item.v2) ] );
				}
				if (bHaveDelivered) {
					datatableReturn1.push( [cdate, parseFloat(item.r1) ] );
					if (typeof item.r2!= 'undefined') {
						datatableReturn2.push( [cdate, parseFloat(item.r2) ] );
					}
				}
				if (datatableUsage2.length>0) {
					datatableTotalUsage.push( [cdate, parseFloat(item.v)+parseFloat(item.v2) ] );
				}
				else {
					datatableTotalUsage.push( [cdate, parseFloat(item.v) ] );
				}
				if (datatableUsage2.length>0) {
					datatableTotalReturn.push( [cdate, parseFloat(item.r1)+parseFloat(item.r2) ] );
				}
				else {
					datatableTotalReturn.push( [cdate, parseFloat(item.r1) ] );
				}
			}
    });

    var series;
    if (switchtype==0)
    {
		if ((chart == $.DayChart)||(chart == $.WeekChart)) {
			if (datatableUsage1.length>0) {
				if (datatableUsage2.length>0) {
					chart.addSeries({
					  id: 'usage1',
					  name: 'Usage_1',
					  color: 'rgba(60,130,252,0.8)',
					  stack: 'susage',
					  yAxis: 0
					});
				}
				else {
					chart.addSeries({
					  id: 'usage1',
					  name: 'Usage',
					  color: 'rgba(3,190,252,0.8)',
					  stack: 'susage',
					  yAxis: 0
					});
				}
				series = chart.get('usage1');
				series.setData(datatableUsage1);
			}
			if (datatableUsage2.length>0) {
				chart.addSeries({
				  id: 'usage2',
				  name: 'Usage_2',
				  color: 'rgba(3,190,252,0.8)',
				  stack: 'susage',
				  yAxis: 0
				});
				series = chart.get('usage2');
				series.setData(datatableUsage2);
			}
			if (bHaveDelivered) {
				if (datatableReturn1.length>0) {
					chart.addSeries({
						id: 'return1',
						name: 'Return_1',
						color: 'rgba(30,242,110,0.8)',
						stack: 'sreturn',
						yAxis: 0
					});
					series = chart.get('return1');
					series.setData(datatableReturn1);
				}
				if (datatableReturn2.length>0) {
					chart.addSeries({
						id: 'return2',
						name: 'Return_2',
						color: 'rgba(3,252,190,0.8)',
						stack: 'sreturn',
						yAxis: 0
					});
					series = chart.get('return2');
					series.setData(datatableReturn2);
				}
			}
		}
		else {
			//month/year, show total for now
			if (datatableTotalUsage.length>0) {
				chart.addSeries({
				  id: 'usage',
				  name: 'Total_Usage',
				  color: 'rgba(3,190,252,0.8)',
				  yAxis: 0
				});
				series = chart.get('usage');
				series.setData(datatableTotalUsage);
			}
			if (bHaveDelivered) {
				if (datatableTotalReturn.length>0) {
					chart.addSeries({
						id: 'return',
						name: 'Total_Return',
						color: 'rgba(3,252,190,0.8)',
						yAxis: 0
					});
					series = chart.get('return');
					series.setData(datatableTotalReturn);
				}
			}
		}
		if (chart == $.DayChart) {
			chart.yAxis[0].axisTitle.attr({
				text: $.i18n('Energy') + ' Watt'
			});			
		}
		else {
			chart.yAxis[0].axisTitle.attr({
				text: $.i18n('Energy') + ' kWh'
			});			
		}
		chart.yAxis[0].redraw();
    }
    else if (switchtype==1)
    {
		//gas
		chart.addSeries({
          id: 'gas',
          name: 'Gas',
          color: 'rgba(3,190,252,0.8)',
          yAxis: 0
        });
		chart.yAxis[0].axisTitle.attr({
			text: 'Gas m3'
		});			
		series = chart.get('gas');
		series.setData(datatableUsage1);
    }
    else if (switchtype==2)
    {
		//water
		chart.addSeries({
          id: 'water',
          name: 'Water',
          color: 'rgba(3,190,252,0.8)',
          yAxis: 0
        });
		chart.yAxis[0].axisTitle.attr({
			text: 'Water m3'
		});			
		series = chart.get('water');
		series.setData(datatableUsage1);
    }
    else if (switchtype==3)
    {
		//counter
		chart.addSeries({
          id: 'counter',
          name: 'Counter',
          color: 'rgba(3,190,252,0.8)',
          yAxis: 0
        });
		chart.yAxis[0].axisTitle.attr({
			text: 'Count'
		});			
		series = chart.get('counter');
		series.setData(datatableUsage1);
    }
}

function AddDataToCurrentChart(data,chart,switchtype)
{
    var datatablev1 = [];
    var datatablev2 = [];
    var datatablev3 = [];
    var datatablev4 = [];
    var datatablev5 = [];
    var datatablev6 = [];

    $.each(data.result, function(i,item)
    {
			if (chart == $.DayChart) {
       datatablev1.push( [GetUTCFromString(item.d), parseFloat(item.v1) ] );
       datatablev2.push( [GetUTCFromString(item.d), parseFloat(item.v2) ] );
       datatablev3.push( [GetUTCFromString(item.d), parseFloat(item.v3) ] );
			}
			else {
       datatablev1.push( [GetDateFromString(item.d), parseFloat(item.v1) ] );
       datatablev2.push( [GetDateFromString(item.d), parseFloat(item.v2) ] );
       datatablev3.push( [GetDateFromString(item.d), parseFloat(item.v3) ] );
       datatablev4.push( [GetDateFromString(item.d), parseFloat(item.v4) ] );
       datatablev5.push( [GetDateFromString(item.d), parseFloat(item.v5) ] );
       datatablev6.push( [GetDateFromString(item.d), parseFloat(item.v6) ] );
			}
    });

    var series;
    if (switchtype==0)
    {
			//Current (A)
			if (chart == $.DayChart) {
				if (data.haveL1) {
					chart.addSeries(
						{
							id: 'current1',
							name: 'Current_L1',
							color: 'rgba(3,190,252,0.8)',
							yAxis: 0
						}
					);
					series = chart.get('current1');
					series.setData(datatablev1);
				}
				if (data.haveL2) {
					chart.addSeries(
						{
							id: 'current2',
							name: 'Current_L2',
							color: 'rgba(252,190,3,0.8)',
							yAxis: 0
						}
					);
					series = chart.get('current2');
					series.setData(datatablev2);
				}
				if (data.haveL3) {
					chart.addSeries(
						{
							id: 'current3',
							name: 'Current_L3',
							color: 'rgba(190,252,3,0.8)',
							yAxis: 0
						}
					);
					series = chart.get('current3');
					series.setData(datatablev3);
				}
			}
			else {
				if (data.haveL1) {
					chart.addSeries(
						{
							id: 'current1min',
							name: 'Current_L1_Min',
							color: 'rgba(3,190,252,0.8)',
							yAxis: 0
						}
					);
					chart.addSeries(
						{
							id: 'current1max',
							name: 'Current_L1_Max',
							color: 'rgba(3,252,190,0.8)',
							yAxis: 0
						}
					);
					series = chart.get('current1min');
					series.setData(datatablev1);
					series = chart.get('current1max');
					series.setData(datatablev2);
				}
				if (data.haveL2) {
					chart.addSeries(
						{
							id: 'current2min',
							name: 'Current_L2_Min',
							color: 'rgba(252,190,3,0.8)',
							yAxis: 0
						}
					);
					chart.addSeries(
						{
							id: 'current2max',
							name: 'Current_L2_Max',
							color: 'rgba(252,3,190,0.8)',
							yAxis: 0
						}
					);
					series = chart.get('current2min');
					series.setData(datatablev3);
					series = chart.get('current2max');
					series.setData(datatablev4);
				}
				if (data.haveL3) {
					chart.addSeries(
						{
							id: 'current3min',
							name: 'Current_L3_Min',
							color: 'rgba(190,252,3,0.8)',
							yAxis: 0
						}
					);
					chart.addSeries(
						{
							id: 'current3max',
							name: 'Current_L3_Min',
							color: 'rgba(112,146,190,0.8)',
							yAxis: 0
						}
					);
					series = chart.get('current3min');
					series.setData(datatablev5);
					series = chart.get('current3max');
					series.setData(datatablev6);
				}
			}
			chart.yAxis[0].axisTitle.attr({
					text: 'Current (A)'
			});			
    }
    else if (switchtype==1)
    {
			//Watt
			if (chart == $.DayChart) {
				if (data.haveL1) {
					chart.addSeries(
						{
							id: 'current1',
							name: 'Usage_L1',
							color: 'rgba(3,190,252,0.8)',
							yAxis: 0
						}
					);
					series = chart.get('current1');
					series.setData(datatablev1);
				}
				if (data.haveL2) {
					chart.addSeries(
						{
							id: 'current2',
							name: 'Usage_L2',
							color: 'rgba(252,190,3,0.8)',
							yAxis: 0
						}
					);
					series = chart.get('current2');
					series.setData(datatablev2);
				}
				if (data.haveL3) {
					chart.addSeries(
						{
							id: 'current3',
							name: 'Usage_L3',
							color: 'rgba(190,252,3,0.8)',
							yAxis: 0
						}
					);
					series = chart.get('current3');
					series.setData(datatablev3);
				}
			}
			else {
				if (data.haveL1) {
					chart.addSeries(
						{
							id: 'current1min',
							name: 'Usage_L1_Min',
							color: 'rgba(3,190,252,0.8)',
							yAxis: 0
						}
					);
					chart.addSeries(
						{
							id: 'current1max',
							name: 'Usage_L1_Max',
							color: 'rgba(3,252,190,0.8)',
							yAxis: 0
						}
					);
					series = chart.get('current1min');
					series.setData(datatablev1);
					series = chart.get('current1max');
					series.setData(datatablev2);
				}
				if (data.haveL2) {
					chart.addSeries(
						{
							id: 'current2min',
							name: 'Usage_L2_Min',
							color: 'rgba(252,190,3,0.8)',
							yAxis: 0
						}
					);
					chart.addSeries(
						{
							id: 'current2max',
							name: 'Usage_L2_Max',
							color: 'rgba(252,3,190,0.8)',
							yAxis: 0
						}
					);
					series = chart.get('current2min');
					series.setData(datatablev3);
					series = chart.get('current2max');
					series.setData(datatablev4);
				}
				if (data.haveL3) {
					chart.addSeries(
						{
							id: 'current3min',
							name: 'Usage_L3_Min',
							color: 'rgba(190,252,3,0.8)',
							yAxis: 0
						}
					);
					chart.addSeries(
						{
							id: 'current3max',
							name: 'Usage_L3_Min',
							color: 'rgba(112,146,190,0.8)',
							yAxis: 0
						}
					);
					series = chart.get('current3min');
					series.setData(datatablev5);
					series = chart.get('current3max');
					series.setData(datatablev6);
				}
			}
			chart.yAxis[0].axisTitle.attr({
					text: 'Usage (Watt)'
			});			
    }
		chart.yAxis[0].redraw();
}

function ShowCurrentLog(id,name,switchtype)
{
	clearInterval($.myglobals.refreshTimer);
  $('#modal').show();
  $.devIdx=id;
  $.devName=name;
  $.devSwitchType=switchtype;
  var htmlcontent = '';
  htmlcontent='<p><center><h2>' + name + '</h2></center></p>\n';
  htmlcontent+=$('#currentlog').html();
  $('#utilitycontent').html(GetBackbuttonHTMLTable('ShowUtilities')+htmlcontent);
  $('#utilitycontent').i18n();
  
  $.DayChart = new Highcharts.Chart({
      chart: {
          renderTo: 'currentdaygraph',
          type: 'line',
          zoomType: 'xy',
          events: {
              load: function() {
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=day",
                function(data) {
											AddDataToCurrentChart(data,$.DayChart,switchtype);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: Get5MinuteHistoryDaysGraphTitle()
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: $.i18n('Usage')
            },
            min: 0
        },
        tooltip: {
            formatter: function() {
										var unit = {
																'Usage': 'Watt',
																'Current_L1': 'A',
																'Current_L2': 'A',
																'Current_L3': 'A',
																'Usage_L1': 'Watt',
																'Usage_L2': 'Watt',
																'Usage_L3': 'Watt'
													}[this.series.name];
                    return this.series.name + ':<br/>' + $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +': '+ this.y + ' ' + unit;
            }
        },
        plotOptions: {
						 line: {
									lineWidth: 3,
									states: {
											hover: {
													lineWidth: 3
											}
									},
									marker: {
											enabled: false,
											states: {
													hover: {
															enabled: true,
															symbol: 'circle',
															radius: 5,
															lineWidth: 1
													}
											}
									}
							}
        },
        legend: {
            enabled: true
        }
    });
  
  $.MonthChart = new Highcharts.Chart({
      chart: {
          renderTo: 'currentmonthgraph',
          type: 'spline',
          marginRight: 10,
          zoomType: 'xy',
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=month",
                function(data) {
											AddDataToCurrentChart(data,$.MonthChart,switchtype);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Last Month')
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: $.i18n('Usage')
            },
            min: 0
        },
        tooltip: {
            formatter: function() {
										var unit = {
																'Usage': 'kWh',
																'Current_L1_Min': 'A',
																'Current_L1_Max': 'A',
																'Current_L2_Min': 'A',
																'Current_L2_Max': 'A',
																'Current_L3_Min': 'A',
																'Current_L3_Max': 'A',
																'Usage_L1_Min': 'Watt',
																'Usage_L1_Max': 'Watt',
																'Usage_L2_Min': 'Watt',
																'Usage_L2_Max': 'Watt',
																'Usage_L3_Min': 'Watt',
																'Usage_L3_Max': 'Watt'
													}[this.series.name];
                    return this.series.name + ':<br/>' + $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d', this.x) +': '+ this.y + ' ' + unit;
            }
        },
        plotOptions: {
			series: {
				point: {
					events: {
						click: function(event) {
							chartPointClickEx(event,ShowCurrentLog);
						}
					}
				}
			},
			spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        legend: {
            enabled: true
        }
    });

  $.YearChart = new Highcharts.Chart({
      chart: {
          renderTo: 'currentyeargraph',
          type: 'spline',
          marginRight: 10,
          zoomType: 'xy',
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=year",
                function(data) {
											AddDataToCurrentChart(data,$.YearChart,switchtype);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Last Year')
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: $.i18n('Usage')
            },
            min: 0
        },
        tooltip: {
            formatter: function() {
										var unit = {
																'Usage': 'kWh',
																'Current_L1_Min': 'A',
																'Current_L1_Max': 'A',
																'Current_L2_Min': 'A',
																'Current_L2_Max': 'A',
																'Current_L3_Min': 'A',
																'Current_L3_Max': 'A',
																'Usage_L1_Min': 'Watt',
																'Usage_L1_Max': 'Watt',
																'Usage_L2_Min': 'Watt',
																'Usage_L2_Max': 'Watt',
																'Usage_L3_Min': 'Watt',
																'Usage_L3_Max': 'Watt'
													}[this.series.name];
                    return this.series.name + ':<br/>' + $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d', this.x) +': '+ this.y + ' ' + unit;
            }
        },
        plotOptions: {
			series: {
				point: {
					events: {
						click: function(event) {
							chartPointClickEx(event,ShowCurrentLog);
						}
					}
				}
			},
			spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        legend: {
            enabled: true
        }
    });
}

function ShowAirQualityLog(id,name)
{
	clearInterval($.myglobals.refreshTimer);
  $('#modal').show();
  $.devIdx=id;
  $.devName=name;
  var htmlcontent = '';
  htmlcontent='<p><center><h2>' + name + '</h2></center></p>\n';
  htmlcontent+=$('#airlog').html();
  $('#utilitycontent').html(GetBackbuttonHTMLTable('ShowUtilities')+htmlcontent);
  $('#utilitycontent').i18n();

  $.DayChart = new Highcharts.Chart({
      chart: {
          renderTo: 'airdaygraph',
          type: 'spline',
          zoomType: 'xy',
          marginRight: 10,
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=day",
                function(data) {
                      var series = $.DayChart.series[0];
                      var datatable = [];
                      
                      $.each(data.result, function(i,item)
                      {
                        datatable.push( [GetUTCFromString(item.d), parseInt(item.co2) ] );
                      });
                      series.setData(datatable);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Air Quality') + ' '  + Get5MinuteHistoryDaysGraphTitle()
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: 'co2 (ppm)'
            },
            min: 0,
            minorGridLineWidth: 0,
            gridLineWidth: 0,
            alternateGridColor: null,
            plotBands: [{ // Excellent
                from: 0,
                to: 700,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Excellent'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Good
                from: 700,
                to: 900,
                color: 'rgba(68, 170, 213, 0.5)',
                label: {
                    text: $.i18n('Good'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Fair
                from: 900,
                to: 1100,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Fair'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Mediocre
                from: 1100,
                to: 1600,
                color: 'rgba(68, 170, 213, 0.5)',
                label: {
                    text: $.i18n('Mediocre'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Bad
                from: 1600,
                to: 6000,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Bad'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }
           ]
        },
        tooltip: {
            formatter: function() {
                    return ''+
                    $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +': '+ this.y +' ppm';
            }
        },
        plotOptions: {
            spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        series: [{
            name: 'co2'
        }]
        ,
        navigation: {
            menuItemStyle: {
                fontSize: '10px'
            }
        }
    });

  $.MonthChart = new Highcharts.Chart({
      chart: {
          renderTo: 'airmonthgraph',
          type: 'spline',
          zoomType: 'xy',
          marginRight: 10,
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=month",
                function(data) {
                      var datatable1 = [];
                      var datatable2 = [];
                      
                      $.each(data.result, function(i,item)
                      {
                        datatable1.push( [GetDateFromString(item.d), parseInt(item.co2_min) ] );
                        datatable2.push( [GetDateFromString(item.d), parseInt(item.co2_max) ] );
                      });
                      var series1 = $.MonthChart.series[0];
                      var series2 = $.MonthChart.series[1];
                      series1.setData(datatable1);
                      series2.setData(datatable2);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Air Quality') + ' ' + $.i18n('Last Month')
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: 'co2 (ppm)'
            },
            min: 0,
            minorGridLineWidth: 0,
            gridLineWidth: 0,
            alternateGridColor: null,
            plotBands: [{ // Excellent
                from: 0,
                to: 700,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Excellent'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Good
                from: 700,
                to: 900,
                color: 'rgba(68, 170, 213, 0.5)',
                label: {
                    text: $.i18n('Good'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Fair
                from: 900,
                to: 1100,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Fair'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Mediocre
                from: 1100,
                to: 1600,
                color: 'rgba(68, 170, 213, 0.5)',
                label: {
                    text: $.i18n('Mediocre'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Bad
                from: 1600,
                to: 6000,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Bad'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }
           ]
        },
        tooltip: {
            formatter: function() {
                    return ''+
                    $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +': '+ this.y +' ppm';
            }
        },
        plotOptions: {
            spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        series: [{
            name: 'co2_min',
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowCounterLog);
					}
				}
			}
		}, {
            name: 'co2_max',
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowCounterLog);
					}
				}
			}
        }]
        ,
        navigation: {
            menuItemStyle: {
                fontSize: '10px'
            }
        }
    });

  $.YearChart = new Highcharts.Chart({
      chart: {
          renderTo: 'airyeargraph',
          type: 'spline',
          zoomType: 'xy',
          marginRight: 10,
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=year",
                function(data) {
                      var datatable1 = [];
                      var datatable2 = [];
                      
                      $.each(data.result, function(i,item)
                      {
                        datatable1.push( [GetDateFromString(item.d), parseInt(item.co2_min) ] );
                        datatable2.push( [GetDateFromString(item.d), parseInt(item.co2_max) ] );
                      });
                      var series1 = $.YearChart.series[0];
                      var series2 = $.YearChart.series[1];
                      series1.setData(datatable1);
                      series2.setData(datatable2);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Air Quality') + ' ' + $.i18n('Last Year')
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: 'co2 (ppm)'
            },
            min: 0,
            minorGridLineWidth: 0,
            gridLineWidth: 0,
            alternateGridColor: null,
            plotBands: [{ // Excellent
                from: 0,
                to: 700,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Excellent'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Good
                from: 700,
                to: 900,
                color: 'rgba(68, 170, 213, 0.5)',
                label: {
                    text: $.i18n('Good'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Fair
                from: 900,
                to: 1100,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Fair'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Mediocre
                from: 1100,
                to: 1600,
                color: 'rgba(68, 170, 213, 0.5)',
                label: {
                    text: $.i18n('Mediocre'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Bad
                from: 1600,
                to: 6000,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Bad'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }
           ]
        },
        tooltip: {
            formatter: function() {
                    return ''+
                    $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +': '+ this.y +' ppm';
            }
        },
        plotOptions: {
            spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        series: [{
            name: 'co2_min',
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowCounterLog);
					}
				}
			}
		}, {
            name: 'co2_max',
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowCounterLog);
					}
				}
			}
        }]
        ,
        navigation: {
            menuItemStyle: {
                fontSize: '10px'
            }
        }
    });
}

function ShowLuxLog(id,name)
{
	clearInterval($.myglobals.refreshTimer);
  $('#modal').show();
  $.devIdx=id;
  $.devName=name;
  var htmlcontent = '';
  htmlcontent='<p><center><h2>' + name + '</h2></center></p>\n';
  htmlcontent+=$('#luxlog').html();
  $('#utilitycontent').html(GetBackbuttonHTMLTable('ShowUtilities')+htmlcontent);
  $('#utilitycontent').i18n();

  $.DayChart = new Highcharts.Chart({
      chart: {
          renderTo: 'luxdaygraph',
          type: 'spline',
          zoomType: 'xy',
          marginRight: 10,
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=day",
                function(data) {
                      var series = $.DayChart.series[0];
                      var datatable = [];
                      
                      $.each(data.result, function(i,item)
                      {
                        datatable.push( [GetUTCFromString(item.d), parseInt(item.lux) ] );
                      });
                      series.setData(datatable);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Lux') + ' '  + Get5MinuteHistoryDaysGraphTitle()
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: 'Lux'
            },
            min: 0,
            minorGridLineWidth: 0,
            gridLineWidth: 0,
            alternateGridColor: null
        },
        tooltip: {
            formatter: function() {
                    return ''+
                    $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +': '+ this.y +' Lux';
            }
        },
        plotOptions: {
            spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        series: [{
            name: 'lux'
        }]
        ,
        navigation: {
            menuItemStyle: {
                fontSize: '10px'
            }
        }
    });

  $.MonthChart = new Highcharts.Chart({
      chart: {
          renderTo: 'luxmonthgraph',
          type: 'spline',
          zoomType: 'xy',
          marginRight: 10,
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=month",
                function(data) {
                      var datatable1 = [];
                      var datatable2 = [];
                      
                      $.each(data.result, function(i,item)
                      {
                        datatable1.push( [GetDateFromString(item.d), parseInt(item.lux_min) ] );
                        datatable2.push( [GetDateFromString(item.d), parseInt(item.lux_max) ] );
                      });
                      var series1 = $.MonthChart.series[0];
                      var series2 = $.MonthChart.series[1];
                      series1.setData(datatable1);
                      series2.setData(datatable2);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Lux') + ' ' + $.i18n('Last Month')
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: 'Lux'
            },
            min: 0,
            minorGridLineWidth: 0,
            gridLineWidth: 0,
            alternateGridColor: null
        },
        tooltip: {
            formatter: function() {
                    return ''+
                    $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +': '+ this.y +' Lux';
            }
        },
        plotOptions: {
            spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        series: [{
            name: 'lux_min',
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowCounterLog);
					}
				}
			}
		}, {
            name: 'lux_max',
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowCounterLog);
					}
				}
			}
        }]
        ,
        navigation: {
            menuItemStyle: {
                fontSize: '10px'
            }
        }
    });

  $.YearChart = new Highcharts.Chart({
      chart: {
          renderTo: 'luxyeargraph',
          type: 'spline',
          zoomType: 'xy',
          marginRight: 10,
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=year",
                function(data) {
                      var datatable1 = [];
                      var datatable2 = [];
                      
                      $.each(data.result, function(i,item)
                      {
                        datatable1.push( [GetDateFromString(item.d), parseInt(item.lux_min) ] );
                        datatable2.push( [GetDateFromString(item.d), parseInt(item.lux_max) ] );
                      });
                      var series1 = $.YearChart.series[0];
                      var series2 = $.YearChart.series[1];
                      series1.setData(datatable1);
                      series2.setData(datatable2);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Lux') + ' ' + $.i18n('Last Year')
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: 'Lux'
            },
            min: 0,
            minorGridLineWidth: 0,
            gridLineWidth: 0,
            alternateGridColor: null
        },
        tooltip: {
            formatter: function() {
                    return ''+
                    $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +': '+ this.y +' Lux';
            }
        },
        plotOptions: {
            spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        series: [{
            name: 'lux_min',
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowCounterLog);
					}
				}
			}
		}, {
            name: 'lux_max',
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowCounterLog);
					}
				}
			}
        }]
        ,
        navigation: {
            menuItemStyle: {
                fontSize: '10px'
            }
        }
    });
}

function ShowPercentageLog(id,name)
{
	clearInterval($.myglobals.refreshTimer);
  $('#modal').show();
  $.devIdx=id;
  $.devName=name;
  var htmlcontent = '';
  htmlcontent='<p><center><h2>' + name + '</h2></center></p>\n';
  htmlcontent+=$('#percentagelog').html();
  $('#utilitycontent').html(GetBackbuttonHTMLTable('ShowUtilities')+htmlcontent);
  $('#utilitycontent').i18n();

  $.DayChart = new Highcharts.Chart({
      chart: {
          renderTo: 'percentagedaygraph',
          type: 'spline',
          zoomType: 'xy',
          marginRight: 10,
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=day",
                function(data) {
                      var series = $.DayChart.series[0];
                      var datatable = [];
                      
                      $.each(data.result, function(i,item)
                      {
                        datatable.push( [GetUTCFromString(item.d), parseInt(item.v) ] );
                      });
                      series.setData(datatable);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Percentage') + ' '  + Get5MinuteHistoryDaysGraphTitle()
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: 'Percentage'
            },
            min: 0,
            minorGridLineWidth: 0,
            gridLineWidth: 0,
            alternateGridColor: null
        },
        tooltip: {
            formatter: function() {
                    return ''+
                    $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +': '+ this.y +' %%';
            }
        },
        plotOptions: {
            spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        series: [{
            name: 'Percentage'
        }]
        ,
        navigation: {
            menuItemStyle: {
                fontSize: '10px'
            }
        }
    });

  $.MonthChart = new Highcharts.Chart({
      chart: {
          renderTo: 'percentagemonthgraph',
          type: 'spline',
          zoomType: 'xy',
          marginRight: 10,
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=month",
                function(data) {
                      var datatable1 = [];
                      var datatable2 = [];
                      
                      $.each(data.result, function(i,item)
                      {
                        datatable1.push( [GetDateFromString(item.d), parseInt(item.v_min) ] );
                        datatable2.push( [GetDateFromString(item.d), parseInt(item.v_max) ] );
                      });
                      var series1 = $.MonthChart.series[0];
                      var series2 = $.MonthChart.series[1];
                      series1.setData(datatable1);
                      series2.setData(datatable2);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Percentage') + ' ' + $.i18n('Last Month')
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: 'Percentage'
            },
            min: 0,
            minorGridLineWidth: 0,
            gridLineWidth: 0,
            alternateGridColor: null
        },
        tooltip: {
            formatter: function() {
                    return ''+
                    $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +': '+ this.y +' %';
            }
        },
        plotOptions: {
            spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        series: [{
            name: 'min',
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowCounterLog);
					}
				}
			}
		}, {
            name: 'max',
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowCounterLog);
					}
				}
			}
        }]
        ,
        navigation: {
            menuItemStyle: {
                fontSize: '10px'
            }
        }
    });

  $.YearChart = new Highcharts.Chart({
      chart: {
          renderTo: 'percentageyeargraph',
          type: 'spline',
          zoomType: 'xy',
          marginRight: 10,
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=year",
                function(data) {
                      var datatable1 = [];
                      var datatable2 = [];
                      
                      $.each(data.result, function(i,item)
                      {
                        datatable1.push( [GetDateFromString(item.d), parseInt(item.v_min) ] );
                        datatable2.push( [GetDateFromString(item.d), parseInt(item.v_max) ] );
                      });
                      var series1 = $.YearChart.series[0];
                      var series2 = $.YearChart.series[1];
                      series1.setData(datatable1);
                      series2.setData(datatable2);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Percentage') + ' ' + $.i18n('Last Year')
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: 'Percentage'
            },
            min: 0,
            minorGridLineWidth: 0,
            gridLineWidth: 0,
            alternateGridColor: null
        },
        tooltip: {
            formatter: function() {
                    return ''+
                    $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +': '+ this.y +' %';
            }
        },
        plotOptions: {
            spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        series: [{
            name: 'min',
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowCounterLog);
					}
				}
			}
		}, {
            name: 'max',
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowCounterLog);
					}
				}
			}
        }]
        ,
        navigation: {
            menuItemStyle: {
                fontSize: '10px'
            }
        }
    });
}

function ShowUsageLog(id,name)
{
	clearInterval($.myglobals.refreshTimer);
  $('#modal').show();
  $.devIdx=id;
  $.devName=name;
  var htmlcontent = '';
  htmlcontent='<p><center><h2>' + name + '</h2></center></p>\n';
  htmlcontent+=$('#usagelog').html();
  $('#utilitycontent').html(GetBackbuttonHTMLTable('ShowUtilities')+htmlcontent);
  $('#utilitycontent').i18n();

  $.DayChart = new Highcharts.Chart({
      chart: {
          renderTo: 'usagedaygraph',
          type: 'spline',
          zoomType: 'xy',
          marginRight: 10,
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=day",
                function(data) {
                      var series = $.DayChart.series[0];
                      var datatable = [];
                      
                      $.each(data.result, function(i,item)
                      {
                        datatable.push( [GetUTCFromString(item.d), parseFloat(item.u) ] );
                      });
                      series.setData(datatable);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Usage') + ' '  + Get5MinuteHistoryDaysGraphTitle()
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: $.i18n('Usage') + ' (Watt)'
            },
            min: 0
        },
        tooltip: {
            formatter: function() {
                    return ''+
                    $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +': '+ this.y +' Watt';
            }
        },
        plotOptions: {
            spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        series: [{
            name: $.i18n('Usage')
        }]
        ,
        navigation: {
            menuItemStyle: {
                fontSize: '10px'
            }
        }
    });

  $.MonthChart = new Highcharts.Chart({
      chart: {
          renderTo: 'usagemonthgraph',
          type: 'spline',
          zoomType: 'xy',
          marginRight: 10,
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=month",
                function(data) {
                      var datatable1 = [];
                      var datatable2 = [];
                      
                      $.each(data.result, function(i,item)
                      {
                        datatable1.push( [GetDateFromString(item.d), parseFloat(item.u_min) ] );
                        datatable2.push( [GetDateFromString(item.d), parseFloat(item.u_max) ] );
                      });
                      var series1 = $.MonthChart.series[0];
                      var series2 = $.MonthChart.series[1];
                      series1.setData(datatable1);
                      series2.setData(datatable2);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Usage') + ' ' + $.i18n('Last Month')
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: $.i18n('Usage') + ' (Watt)'
            },
            min: 0
        },
        tooltip: {
            formatter: function() {
                    return ''+
                    $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +': '+ this.y +' Watt';
            }
        },
        plotOptions: {
            spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        series: [{
            name: 'Usage_min',
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowCounterLog);
					}
				}
			}
		}, {
            name: 'Usage_max',
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowCounterLog);
					}
				}
			}
        }]
        ,
        navigation: {
            menuItemStyle: {
                fontSize: '10px'
            }
        }
    });

  $.YearChart = new Highcharts.Chart({
      chart: {
          renderTo: 'usageyeargraph',
          type: 'spline',
          zoomType: 'xy',
          marginRight: 10,
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=year",
                function(data) {
                      var datatable1 = [];
                      var datatable2 = [];
                      
                      $.each(data.result, function(i,item)
                      {
                        datatable1.push( [GetDateFromString(item.d), parseFloat(item.u_min) ] );
                        datatable2.push( [GetDateFromString(item.d), parseFloat(item.u_max) ] );
                      });
                      var series1 = $.YearChart.series[0];
                      var series2 = $.YearChart.series[1];
                      series1.setData(datatable1);
                      series2.setData(datatable2);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Usage') + ' ' + $.i18n('Last Year')
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: $.i18n('Usage') + ' (Watt)'
            },
            min: 0
        },
        tooltip: {
            formatter: function() {
                    return ''+
                    $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +': '+ this.y +' Watt';
            }
        },
        plotOptions: {
            spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        series: [{
            name: 'Usage_min',
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowCounterLog);
					}
				}
			}
		}, {
            name: 'Usage_max',
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowCounterLog);
					}
				}
			}
        }]
        ,
        navigation: {
            menuItemStyle: {
                fontSize: '10px'
            }
        }
    });
}

function ShowCounterLog(id,name,switchtype)
{
	clearInterval($.myglobals.refreshTimer);
  $('#modal').show();
  $.devIdx=id;
  $.devName=name;
  $.devSwitchType=switchtype;
  var htmlcontent = '';
  htmlcontent='<p><center><h2>' + name + '</h2></center></p>\n';
  htmlcontent+=$('#counterlog').html();

  if ((switchtype==0)||(switchtype==1)) {
	$.costsT1=0.2389;
	$.costsT2=0.2389;
	$.costsGas=0.6218;

	$.ajax({
		 url: "json.htm?type=command&param=getelectragascosts&idx="+$.devIdx,
		 async: false, 
		 dataType: 'json',
		 success: function(data) {
			$.costsT1=parseFloat(data.CostEnergy)/10000;
			$.costsT2=parseFloat(data.CostEnergyT2)/10000;
			$.costsGas=parseFloat(data.CostGas)/10000;
		 }
	});

	$.costsR1=$.costsT1;
	$.costsR2=$.costsT2;

	$.monthNames = [ "January", "February", "March", "April", "May", "June",
    "July", "August", "September", "October", "November", "December" ];
    
	var d = new Date();
	var actMonth = d.getMonth()+1;
	var actYear = d.getYear()+1900;
	$('#utilitycontent').html(GetBackbuttonHTMLTableWithRight('ShowUtilities','ShowP1YearReportGas('+actYear+')',$.i18n('Report'))+htmlcontent);
  }
  else {
	$('#utilitycontent').html(GetBackbuttonHTMLTable('ShowUtilities')+htmlcontent);
  }

  $('#utilitycontent').i18n();
  
  $.DayChart = new Highcharts.Chart({
      chart: {
          renderTo: 'counterdaygraph',
          type: 'column',
          marginRight: 10,
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=day",
                function(data) {
					AddDataToUtilityChart(data,$.DayChart,switchtype);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Usage') + ' ' + Get5MinuteHistoryDaysGraphTitle()
        },
        xAxis: {
            type: 'datetime',
            labels: {
							formatter: function() {
								return Highcharts.dateFormat("%H:%M", this.value);
							}
						}
        },
        yAxis: {
            title: {
                text: $.i18n('Energy') + ' (Watt)'
            },
            min: 0
        },
        tooltip: {
            formatter: function() {
										var unit = {
																'Usage': 'Watt',
																'Return': 'kWh',
																'Gas': 'm3',
																'Water': 'm3'
													}[this.series.name];
                    return $.i18n(Highcharts.dateFormat('%A',this.x)) + ' ' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) + '<br/>' + this.series.name + ': ' + this.y + ' ' + unit;
            }
        },
        plotOptions: {
            column: {
                minPointLength: 4,
                pointPadding: 0.1,
                groupPadding: 0
            }
        },
        legend: {
            enabled: false
        }
    });
  
  $.WeekChart = new Highcharts.Chart({
      chart: {
          renderTo: 'counterweekgraph',
          type: 'column',
          marginRight: 10,
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=week",
                function(data) {
					AddDataToUtilityChart(data,$.WeekChart,switchtype);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Last Week')
        },
        xAxis: {
            type: 'datetime',
            dateTimeLabelFormats: {
                day: '%a'
            },
            tickInterval: 24 * 3600 * 1000
        },
        yAxis: {
            title: {
                text: $.i18n('Energy') + ' (kWh)'
            },
            min: 0
        },
        tooltip: {
            formatter: function() {
										var unit = {
																'Usage': 'kWh',
																'Return': 'kWh',
																'Gas': 'm3',
																'Water': 'm3'
													}[this.series.name];
                    return $.i18n(Highcharts.dateFormat('%A',this.x)) + ' ' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) + '<br/>' + this.series.name + ': ' + this.y + ' ' + unit;
            }
        },
        plotOptions: {
            column: {
                minPointLength: 4,
                pointPadding: 0.1,
                groupPadding: 0
            }
        },
        legend: {
            enabled: false
        }
    });

  $.MonthChart = new Highcharts.Chart({
      chart: {
          renderTo: 'countermonthgraph',
          type: 'spline',
          marginRight: 10,
          zoomType: 'xy',
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=month",
                function(data) {
					AddDataToUtilityChart(data,$.MonthChart,switchtype);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Last Month')
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: $.i18n('Usage')
            },
            min: 0
        },
        tooltip: {
            formatter: function() {
										var unit = {
																'Usage': 'kWh',
																'Total_Usage': 'kWh',
																'Return': 'kWh',
																'Gas': 'm3',
																'Water': 'm3'
													}[this.series.name];
                    return $.i18n(Highcharts.dateFormat('%A',this.x)) + ' ' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) + '<br/>' + this.series.name + ': ' + this.y + ' ' + unit;
            }
        },
        plotOptions: {
			series: {
				point: {
					events: {
						click: function(event) {
							chartPointClickEx(event,ShowCounterLog);
						}
					}
				}
			},
			spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        legend: {
            enabled: false
        }
    });

  $.YearChart = new Highcharts.Chart({
      chart: {
          renderTo: 'counteryeargraph',
          type: 'spline',
          marginRight: 10,
          zoomType: 'xy',
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=year",
                function(data) {
					AddDataToUtilityChart(data,$.YearChart,switchtype);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Last Year')
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: $.i18n('Usage')
            },
            min: 0
        },
        tooltip: {
            formatter: function() {
										var unit = {
																'Usage': 'kWh',
																'Total_Usage': 'kWh',
																'Return': 'kWh',
																'Gas': 'm3',
																'Water': 'm3'
													}[this.series.name];
                    return $.i18n(Highcharts.dateFormat('%A',this.x)) + ' ' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) + '<br/>' + this.series.name + ': ' + this.y + ' ' + unit;
            }
        },
        plotOptions: {
			series: {
				point: {
					events: {
						click: function(event) {
							chartPointClickEx(event,ShowCounterLog);
						}
					}
				}
			},
			spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        legend: {
            enabled: false
        }
    });
}

function ShowGenericLog(id,name,switchtype)
{
	clearInterval($.myglobals.refreshTimer);
  $('#modal').show();
  $.devIdx=id;
  $.devName=name;
  $.devSwitchType=switchtype;
  var htmlcontent = '';
  htmlcontent='<p><center><h2>' + name + '</h2></center></p>\n';
  htmlcontent+=$('#genericlog').html();
  $('#utilitycontent').html(GetBackbuttonHTMLTable('ShowUtilities')+htmlcontent);
  $('#utilitycontent').i18n();
  
  $.DayChart = new Highcharts.Chart({
      chart: {
          renderTo: 'genericdaygraph',
          type: 'column',
          marginRight: 10,
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=day",
                function(data) {
					AddDataToUtilityChart(data,$.DayChart,switchtype);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Usage') + ' ' + Get5MinuteHistoryDaysGraphTitle()
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: $.i18n('Count')
            },
            min: 0
        },
        tooltip: {
            formatter: function() {
										var unit = {
																'Usage': 'Watt',
																'Return': 'kWh',
																'Gas': 'm3',
																'Water': 'm3',
                                                                'Counter': 'cnt'
													}[this.series.name];
                    return this.series.name + ':<br/>' + $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +': '+ this.y + ' ' + unit;
            }
        },
        plotOptions: {
            column: {
                minPointLength: 4,
                pointPadding: 0.1,
                groupPadding: 0
            }
        },
        legend: {
            enabled: false
        }
    });
  
  $.WeekChart = new Highcharts.Chart({
      chart: {
          renderTo: 'genericweekgraph',
          type: 'column',
          marginRight: 10,
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=week",
                function(data) {
					AddDataToUtilityChart(data,$.WeekChart,switchtype);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Last Week')
        },
        xAxis: {
            type: 'datetime',
            dateTimeLabelFormats: {
                day: '%a'
            },
            tickInterval: 24 * 3600 * 1000
        },
        yAxis: {
            title: {
                text: $.i18n('Count')
            },
            min: 0
        },
        tooltip: {
            formatter: function() {
										var unit = {
																'Usage': 'kWh',
																'Return': 'kWh',
																'Gas': 'm3',
																'Water': 'm3',
                                                                'Counter': 'cnt'
													}[this.series.name];
                    return this.series.name + ':<br/>' + $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d', this.x) +': '+ this.y + ' ' + unit;
            }
        },
        plotOptions: {
            column: {
                minPointLength: 4,
                pointPadding: 0.1,
                groupPadding: 0
            }
        },
        legend: {
            enabled: false
        }
    });

  $.MonthChart = new Highcharts.Chart({
      chart: {
          renderTo: 'genericmonthgraph',
          type: 'spline',
          marginRight: 10,
          zoomType: 'xy',
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=month",
                function(data) {
					AddDataToUtilityChart(data,$.MonthChart,switchtype);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Last Month')
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: $.i18n('Count')
            },
            min: 0
        },
        tooltip: {
            formatter: function() {
										var unit = {
																'Usage': 'kWh',
																'Return': 'kWh',
																'Gas': 'm3',
																'Water': 'm3',
                                                                'Counter': 'cnt'
													}[this.series.name];
                    return this.series.name + ':<br/>' + $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d', this.x) +': '+ this.y + ' ' + unit;
            }
        },
        plotOptions: {
			series: {
				point: {
					events: {
						click: function(event) {
							chartPointClickEx(event,ShowGenericLog);
						}
					}
				}
			},
			spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        legend: {
            enabled: false
        }
    });

  $.YearChart = new Highcharts.Chart({
      chart: {
          renderTo: 'genericyeargraph',
          type: 'spline',
          marginRight: 10,
          zoomType: 'xy',
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=year",
                function(data) {
					AddDataToUtilityChart(data,$.YearChart,switchtype);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Last Year')
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: $.i18n('Count')
            },
            min: 0
        },
        tooltip: {
            formatter: function() {
										var unit = {
																'Usage': 'kWh',
																'Return': 'kWh',
																'Gas': 'm3',
																'Water': 'm3',
                                                                'Counter': 'cnt'
													}[this.series.name];
                    return this.series.name + ':<br/>' + $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d', this.x) +': '+ this.y + ' ' + unit;
            }
        },
        plotOptions: {
			series: {
				point: {
					events: {
						click: function(event) {
							chartPointClickEx(event,ShowGenericLog);
						}
					}
				}
			},
			spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        legend: {
            enabled: false
        }
    });
}

function ShowP1MonthReport(actMonth,actYear)
{
  var htmlcontent = '';

  htmlcontent+=$('#toptextmonth').html();
  htmlcontent+=$('#monthreportview').html();
  $('#utilitycontent').html(htmlcontent);
  $('#utilitycontent').i18n();

  $("#utilitycontent #theader").html($.i18n("Usage")+ " "+ $.i18n($.monthNames[actMonth-1])+" " + actYear);

  $('#utilitycontent #monthreport').dataTable( {
		"sDom": '<"H"rC>t<"F">',
		"oTableTools": {
			"sRowSelect": "single"
		},
		"aaSorting": [[ 0, "asc" ]],
		"aoColumnDefs": [
			{ "bSortable": false, "aTargets": [ 10 ] }
		],
		"bSortClasses": false,
		"bProcessing": true,
		"bStateSave": false,
		"bJQueryUI": true,
		"aLengthMenu": [[50, 100, -1], [50, 100, "All"]],
		"iDisplayLength" : 50
  });
  var mTable = $('#utilitycontent #monthreport');
  var oTable = mTable.dataTable();
  //some test data
  oTable.fnClearTable();
  
  var totalT1=0;
  var totalT2=0;
  var totalR1=0;
  var totalR2=0;
  
	$.getJSON("json.htm?type=graph&sensor=counter&idx="+$.devIdx+"&range=year",
	function(data) {
		var bHaveDelivered=(typeof data.delivered!= 'undefined');
		if (bHaveDelivered==false) {
			$("#utilitycontent #dreturn").hide();
		}
		else {
			$("#utilitycontent #dreturn").show();
		}
		oTable.fnSetColumnVis( 5, bHaveDelivered);
		oTable.fnSetColumnVis( 6, bHaveDelivered);
		oTable.fnSetColumnVis( 7, bHaveDelivered);
		oTable.fnSetColumnVis( 8, bHaveDelivered);
	
		var lastTotal=-1;
		
	    $.each(data.result, function(i,item)
		{
			var month=parseInt(item.d.substring(5, 7), 10);
			var year=parseInt(item.d.substring(0, 4), 10);

			if ((month==actMonth)&&(year==actYear)) {
				var day=parseInt(item.d.substring(8, 10), 10);
				var UsageT1=0;
				var UsageT2=0;
				var ReturnT1=0;
				var ReturnT2=0;

				UsageT1=parseFloat(item.v);
				if (typeof item.v2!= 'undefined') {
					UsageT2=parseFloat(item.v2);
				}
				if (typeof item.r1!= 'undefined') {
					ReturnT1=parseFloat(item.r1);
				}
				if (typeof item.r2!= 'undefined') {
					ReturnT2=parseFloat(item.r2);
				}
			
				totalT1+=UsageT1;
				totalT2+=UsageT2;
				totalR1+=ReturnT1;
				totalR2+=ReturnT2;

				var rcostT1=UsageT1*$.costsT1;
				var rcostT2=UsageT2*$.costsT2;
				var rcostR1=-(ReturnT1*$.costsR1);
				var rcostR2=-(ReturnT2*$.costsR2);
				var rTotal=rcostT1+rcostT2+rcostR1+rcostR2;

				var textR1="";
				var textR2="";
				var textCostR1="";
				var textCostR2="";
				
				if (ReturnT1!=0) {
					textR1=ReturnT1.toFixed(3);
					textCostR1=rcostR1.toFixed(2);
				}
				if (ReturnT2!=0) {
					textR2=ReturnT2.toFixed(3);
					textCostR2=rcostR2.toFixed(2);
				}
				
				var img;
				if ((lastTotal==-1)||(lastTotal==rTotal)) {
					img='<img src="images/equal.png"></img>';
				}
				else if (rTotal<lastTotal) {
					img='<img src="images/down.png"></img>';
				}
				else {
					img='<img src="images/up.png"></img>';
				}
				lastTotal=rTotal;

				var addId = oTable.fnAddData([
					  day,
					  UsageT1.toFixed(3),
					  rcostT1.toFixed(2),
					  UsageT2.toFixed(3),
					  rcostT2.toFixed(2),
					  textR1,
					  textCostR1,
					  textR2,
					  textCostR2,
					  rTotal.toFixed(2),
					  img
					], false);
			}
		});

	  $("#utilitycontent #tut1").html(totalT1.toFixed(3));
	  $("#utilitycontent #tut2").html(totalT2.toFixed(3));
	  $("#utilitycontent #trt1").html(totalR1.toFixed(3));
	  $("#utilitycontent #trt2").html(totalR2.toFixed(3));
	  var gtotal=totalT1+totalT2;
	  var greturn=totalR1+totalR2;
	  $("#utilitycontent #tu").html(gtotal.toFixed(3));
	  $("#utilitycontent #tr").html(greturn.toFixed(3));
	  var montlycosts=(totalT1*$.costsT1)+(totalT2*$.costsT2)-(totalR1*$.costsR1)-(totalR2*$.costsR2);
	  $("#utilitycontent #mc").html(montlycosts.toFixed(2));
	  
	  mTable.fnDraw();
		/* Add a click handler to the rows - this could be used as a callback */
		$("#utilitycontent #monthreport tbody tr").click( function( e ) {
			if ( $(this).hasClass('row_selected') ) {
				$(this).removeClass('row_selected');
			}
			else {
				oTable.$('tr.row_selected').removeClass('row_selected');
				$(this).addClass('row_selected');
			}
		});  
	});

  return false;
}

function OnSelChangeYearP1Report()
{
	var yearidx=$("#utilitycontent #comboyear option:selected").val();
	if (typeof yearidx == 'undefined') {
		return ;
	}
	ShowP1YearReport(yearidx);
}


function Add2YearTableP1Report(oTable,totalT1,totalT2,totalR1,totalR2,lastTotal,lastMonth,actYear)
{

	var rcostT1=totalT1*$.costsT1;
	var rcostT2=totalT2*$.costsT2;
	var rcostR1=-(totalR1*$.costsR1);
	var rcostR2=-(totalR2*$.costsR2);
	var rTotal=rcostT1+rcostT2+rcostR1+rcostR2;

	var textR1="";
	var textR2="";
	var textCostR1="";
	var textCostR2="";

	if (totalR1!=0) {
		textR1=totalR1.toFixed(3);
		textCostR1=rcostR1.toFixed(2);
	}
	if (totalR2!=0) {
		textR2=totalR2.toFixed(3);
		textCostR2=rcostR2.toFixed(2);
	}

	
	var img;
	if ((lastTotal==-1)||(lastTotal==rTotal)) {
		img='<img src="images/equal.png"></img>';
	}
	else if (rTotal<lastTotal) {
		img='<img src="images/down.png"></img>';
	}
	else {
		img='<img src="images/up.png"></img>';
	}

	var monthtxt=lastMonth + ". " + $.i18n($.monthNames[lastMonth-1]) + " ";
	monthtxt+='<img src="images/next.png" onclick="ShowP1MonthReport(' + lastMonth +',' + actYear + ')">';

	var addId = oTable.fnAddData([
		  monthtxt,
		  totalT1.toFixed(3),
		  rcostT1.toFixed(2),
		  totalT2.toFixed(3),
		  rcostT2.toFixed(2),
		  textR1,
		  textCostR1,
		  textR2,
		  textCostR2,
		  rTotal.toFixed(2),
		  img
		], false);
	return rTotal;
}

function ShowP1YearReport(actYear)
{
	if (actYear==0) {
		actYear=$.actYear;
	}
	else {
		$.actYear=actYear;
	}
  var htmlcontent = '';
  htmlcontent+=$('#toptextyear').html();
  htmlcontent+=$('#yearreportview').html();
  $('#utilitycontent').html(htmlcontent);
  $('#utilitycontent').i18n();

  $("#utilitycontent #theader").html($.i18n("Usage") + " "+actYear);

	$("#utilitycontent #comboyear").val(actYear);
	
	$("#utilitycontent #comboyear").change(function() { 
		OnSelChangeYearP1Report();
	});
	$('#utilitycontent #comboyear').keypress(function() {
	  $(this).change();
	});

  $('#utilitycontent #yearreport').dataTable( {
		"sDom": '<"H"rC>t<"F">',
		"oTableTools": {
			"sRowSelect": "single"
		},
		"aaSorting": [[ 0, "asc" ]],
		"aoColumnDefs": [
			{ "bSortable": false, "aTargets": [ 10 ] }
		],
		"bSortClasses": false,
		"bProcessing": true,
		"bStateSave": false,
		"bJQueryUI": true,
		"aLengthMenu": [[50, 100, -1], [50, 100, "All"]],
		"iDisplayLength" : 50
  });
  var mTable = $('#utilitycontent #yearreport');
  var oTable = mTable.dataTable();

  oTable.fnClearTable();
  
  var totalT1=0;
  var totalT2=0;
  var totalR1=0;
  var totalR2=0;

  var globalT1=0;
  var globalT2=0;
  var globalR1=0;
  var globalR2=0;
  
	$.getJSON("json.htm?type=graph&sensor=counter&idx="+$.devIdx+"&range=year",
	function(data) {
		var bHaveDelivered=(typeof data.delivered!= 'undefined');
		if (bHaveDelivered==false) {
			$("#utilitycontent #dreturn").hide();
		}
		else {
			$("#utilitycontent #dreturn").show();
		}
		oTable.fnSetColumnVis( 5, bHaveDelivered);
		oTable.fnSetColumnVis( 6, bHaveDelivered);
		oTable.fnSetColumnVis( 7, bHaveDelivered);
		oTable.fnSetColumnVis( 8, bHaveDelivered);
	
		var lastTotal=-1;
		var lastMonth=-1;
		
	    $.each(data.result, function(i,item)
		{
			var month=parseInt(item.d.substring(5, 7), 10);
			var year=parseInt(item.d.substring(0, 4), 10);

			if (year==actYear) {
				if (lastMonth==-1) {
					lastMonth=month;
				}
				if (lastMonth!=month)
				{
					//add totals to table
					lastTotal=Add2YearTableP1Report(oTable,totalT1,totalT2,totalR1,totalR2,lastTotal,lastMonth,actYear);
					
					lastMonth=month;
					globalT1+=totalT1;
					globalT2+=totalT2;
					globalR1+=totalR1;
					globalR2+=totalR2;

					totalT1=0;
					totalT2=0;
					totalR1=0;
					totalR2=0;
				}
				var day=parseInt(item.d.substring(8, 10), 10);
				var UsageT1=0;
				var UsageT2=0;
				var ReturnT1=0;
				var ReturnT2=0;

				UsageT1=parseFloat(item.v);
				if (typeof item.v2!= 'undefined') {
					UsageT2=parseFloat(item.v2);
				}
				if (typeof item.r1!= 'undefined') {
					ReturnT1=parseFloat(item.r1);
				}
				if (typeof item.r2!= 'undefined') {
					ReturnT2=parseFloat(item.r2);
				}
			
				totalT1+=UsageT1;
				totalT2+=UsageT2;
				totalR1+=ReturnT1;
				totalR2+=ReturnT2;
			}
		});

	//add last month
	if ((globalT1!=0)||(globalT2!=0)||(globalR1!=0)||(globalR2!=0)) {
		lastTotal=Add2YearTableP1Report(oTable,totalT1,totalT2,totalR1,totalR2,lastTotal,lastMonth,actYear);
	}

	$("#utilitycontent #tut1").html(globalT1.toFixed(3));
	  $("#utilitycontent #tut2").html(globalT2.toFixed(3));
	  $("#utilitycontent #trt1").html(globalR1.toFixed(3));
	  $("#utilitycontent #trt2").html(globalR2.toFixed(3));
	  var gtotal=globalT1+globalT2;
	  var greturn=globalR1+globalR2;
	  $("#utilitycontent #tu").html(gtotal.toFixed(3));
	  $("#utilitycontent #tr").html(greturn.toFixed(3));
	  var montlycosts=(globalT1*$.costsT1)+(globalT2*$.costsT2)-(globalR1*$.costsR1)-(globalR2*$.costsR2);
	  $("#utilitycontent #mc").html(montlycosts.toFixed(2));
	  
	  mTable.fnDraw();
		/* Add a click handler to the rows - this could be used as a callback */
		$("#utilitycontent #yearreport tbody tr").click( function( e ) {
			if ( $(this).hasClass('row_selected') ) {
				$(this).removeClass('row_selected');
			}
			else {
				oTable.$('tr.row_selected').removeClass('row_selected');
				$(this).addClass('row_selected');
			}
		});  
	});

  return false;
}

function ShowP1MonthReportGas(actMonth,actYear)
{
  var htmlcontent = '';

  htmlcontent+=$('#toptextmonthgas').html();
  htmlcontent+=$('#monthreportviewgas').html();
  $('#utilitycontent').html(htmlcontent);
  $('#utilitycontent').i18n();

  $("#utilitycontent #theader").html($.i18n("Usage")+ " "+ $.i18n($.monthNames[actMonth-1])+" " + actYear);

	if ($.devSwitchType==0) {
		//Electra
		$("#utilitycontent #munit").html("kWh");
	}
	else {
		//Gas
		$("#utilitycontent #munit").html("m3");
	}

  $('#utilitycontent #monthreport').dataTable( {
		"sDom": '<"H"rC>t<"F">',
		"oTableTools": {
			"sRowSelect": "single"
		},
		"aaSorting": [[ 0, "asc" ]],
		"aoColumnDefs": [
			{ "bSortable": false, "aTargets": [ 3 ] }
		],
		"bSortClasses": false,
		"bProcessing": true,
		"bStateSave": false,
		"bJQueryUI": true,
		"aLengthMenu": [[50, 100, -1], [50, 100, "All"]],
		"iDisplayLength" : 50
  });
  var mTable = $('#utilitycontent #monthreport');
  var oTable = mTable.dataTable();
  //some test data
  oTable.fnClearTable();
  
  var total=0;
  
	$.getJSON("json.htm?type=graph&sensor=counter&idx="+$.devIdx+"&range=year",
	function(data) {
		var lastTotal=-1;
		
	    $.each(data.result, function(i,item)
		{
			var month=parseInt(item.d.substring(5, 7), 10);
			var year=parseInt(item.d.substring(0, 4), 10);

			if ((month==actMonth)&&(year==actYear)) {
				var day=parseInt(item.d.substring(8, 10), 10);
				var Usage=parseFloat(item.v);
			
				total+=Usage;

				var rcost;
				if ($.devSwitchType==0) {
					//Electra
					rcost=Usage*$.costsT1;
				}
				else {
					//Gas
					rcost=Usage*$.costsGas;
				}

				var img;
				if ((lastTotal==-1)||(lastTotal==Usage)) {
					img='<img src="images/equal.png"></img>';
				}
				else if (Usage<lastTotal) {
					img='<img src="images/down.png"></img>';
				}
				else {
					img='<img src="images/up.png"></img>';
				}
				lastTotal=Usage;

				var addId = oTable.fnAddData([
					  day,
					  Usage.toFixed(3),
					  rcost.toFixed(2),
					  img
					], false);
			}
		});

	  $("#utilitycontent #tu").html(total.toFixed(3));
	  
		var montlycosts;
		if ($.devSwitchType==0) {
			//Electra
			montlycosts=(total*$.costsT1)
		}
		else {
			//Gas
			montlycosts=(total*$.costsGas)
		}
		$("#utilitycontent #mc").html(montlycosts.toFixed(2));
	  
	  mTable.fnDraw();
		/* Add a click handler to the rows - this could be used as a callback */
		$("#utilitycontent #monthreport tbody tr").click( function( e ) {
			if ( $(this).hasClass('row_selected') ) {
				$(this).removeClass('row_selected');
			}
			else {
				oTable.$('tr.row_selected').removeClass('row_selected');
				$(this).addClass('row_selected');
			}
		});  
	});

  return false;
}

function OnSelChangeYearP1ReportGas()
{
	var yearidx=$("#utilitycontent #comboyear option:selected").val();
	if (typeof yearidx == 'undefined') {
		return ;
	}
	ShowP1YearReportGas(yearidx);
}


function Add2YearTableP1ReportGas(oTable,total,lastTotal,lastMonth,actYear)
{
	var rcost;
	if ($.devSwitchType==0) {
		//Electra
		rcost=total*$.costsT1;
	}
	else {
		//Gas
		rcost=total*$.costsGas;
	}

	var img;
	if ((lastTotal==-1)||(lastTotal==total)) {
		img='<img src="images/equal.png"></img>';
	}
	else if (total<lastTotal) {
		img='<img src="images/down.png"></img>';
	}
	else {
		img='<img src="images/up.png"></img>';
	}

	var monthtxt=lastMonth + ". " + $.i18n($.monthNames[lastMonth-1]) + " ";
	monthtxt+='<img src="images/next.png" onclick="ShowP1MonthReportGas(' + lastMonth +',' + actYear + ')">';

	var addId = oTable.fnAddData([
		  monthtxt,
		  total.toFixed(3),
		  rcost.toFixed(2),
		  img
		], false);
	return total;
}

function ShowP1YearReportGas(actYear)
{
	if (actYear==0) {
		actYear=$.actYear;
	}
	else {
		$.actYear=actYear;
	}
  var htmlcontent = '';
  htmlcontent+=$('#toptextyeargas').html();
  htmlcontent+=$('#yearreportviewgas').html();
  $('#utilitycontent').html(htmlcontent);
  $('#utilitycontent').i18n();

  $("#utilitycontent #theader").html($.i18n("Usage") + " "+actYear);

	if ($.devSwitchType==0) {
		//Electra
		$("#utilitycontent #munit").html("kWh");
	}
	else {
		//Gas
		$("#utilitycontent #munit").html("m3");
	}

	$("#utilitycontent #comboyear").val(actYear);
	
	$("#utilitycontent #comboyear").change(function() { 
		OnSelChangeYearP1ReportGas();
	});
	$('#utilitycontent #comboyear').keypress(function() {
	  $(this).change();
	});

  $('#utilitycontent #yearreport').dataTable( {
		"sDom": '<"H"rC>t<"F">',
		"oTableTools": {
			"sRowSelect": "single"
		},
		"aaSorting": [[ 0, "asc" ]],
		"aoColumnDefs": [
			{ "bSortable": false, "aTargets": [ 3 ] }
		],
		"bSortClasses": false,
		"bProcessing": true,
		"bStateSave": false,
		"bJQueryUI": true,
		"aLengthMenu": [[50, 100, -1], [50, 100, "All"]],
		"iDisplayLength" : 50
  });

  var mTable = $('#utilitycontent #yearreport');
  var oTable = mTable.dataTable();
  //some test data
  oTable.fnClearTable();
  
  var total=0;
  var global=0;
  
	$.getJSON("json.htm?type=graph&sensor=counter&idx="+$.devIdx+"&range=year",
	function(data) {
		var lastTotal=-1;
		var lastMonth=-1;
		
	    $.each(data.result, function(i,item)
		{
			var month=parseInt(item.d.substring(5, 7), 10);
			var year=parseInt(item.d.substring(0, 4), 10);
			if (year==actYear) {
				if (lastMonth==-1) {
					lastMonth=month;
				}
				if (lastMonth!=month)
				{
					//add totals to table
					lastTotal=Add2YearTableP1ReportGas(oTable,total,lastTotal,lastMonth,actYear);
					
					lastMonth=month;
					global+=total;

					total=0;
				}
				var day=parseInt(item.d.substring(8, 10), 10);
				var Usage=0;

				Usage=parseFloat(item.v);
				total+=Usage;
			}
		});

	//add last month
	if (global!=0) {
		lastTotal=Add2YearTableP1ReportGas(oTable,total,lastTotal,lastMonth,actYear);
		global+=lastTotal;
	}

	$("#utilitycontent #tu").html(global.toFixed(3));
	var montlycosts=0;
	if ($.devSwitchType==0) {
		//Electra
		montlycosts=(global*$.costsT1);
	}
	else {
		//Gas
		montlycosts=(global*$.costsGas);
	}
	
	$("#utilitycontent #mc").html(montlycosts.toFixed(2));
	  
	mTable.fnDraw();
		/* Add a click handler to the rows - this could be used as a callback */
		$("#utilitycontent #yearreport tbody tr").click( function( e ) {
			if ( $(this).hasClass('row_selected') ) {
				$(this).removeClass('row_selected');
			}
			else {
				oTable.$('tr.row_selected').removeClass('row_selected');
				$(this).addClass('row_selected');
			}
		});  
	});

  return false;
}

function ShowSmartLog(id,name,switchtype)
{
	clearInterval($.myglobals.refreshTimer);
  $('#modal').show();
  $.devIdx=id;
  $.devName=name;
  $.devSwitchType=switchtype;
  var htmlcontent = '';
  htmlcontent='<p><center><h2>' + name + '</h2></center></p>\n';
  htmlcontent+=$('#smartlog').html();

	$.costsT1=0.2389;
	$.costsT2=0.2389;
	$.costsGas=0.6218;

	$.ajax({
		 url: "json.htm?type=command&param=getelectragascosts&idx="+$.devIdx,
		 async: false, 
		 dataType: 'json',
		 success: function(data) {
			$.costsT1=parseFloat(data.CostEnergy)/10000;
			$.costsT2=parseFloat(data.CostEnergyT2)/10000;
			$.costsGas=parseFloat(data.CostGas)/10000;
		 }
	});

	$.costsR1=$.costsT1;
	$.costsR2=$.costsT2;

	$.monthNames = [ "January", "February", "March", "April", "May", "June",
    "July", "August", "September", "October", "November", "December" ];
    
	var d = new Date();
	var actMonth = d.getMonth()+1;
	var actYear = d.getYear()+1900;

  $('#utilitycontent').html(GetBackbuttonHTMLTableWithRight('ShowUtilities','ShowP1YearReport('+actYear+')',$.i18n('Report'))+htmlcontent);
  $('#utilitycontent').i18n();
  
  $.DayChart = new Highcharts.Chart({
      chart: {
          renderTo: 'smartdaygraph',
          type: 'line',
          zoomType: 'xy',
          events: {
              load: function() {
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=day",
                function(data) {
					AddDataToUtilityChart(data,$.DayChart,switchtype);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: Get5MinuteHistoryDaysGraphTitle()
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
				title: {
					text: $.i18n('Usage')
				},
				min: 0,
				endOnTick: false,
				startOnTick: false
		},
        tooltip: {
            formatter: function() {
				var unit = {
								'Usage': 'Watt',
								'Usage_1': 'Watt',
								'Usage_2': 'Watt',
								'Return_1': 'Watt',
								'Return_2': 'Watt',
								'Gas': 'm3',
								'Water': 'm3'
							}[this.series.name];
				return $.i18n(Highcharts.dateFormat('%A',this.x)) + ' ' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) + '<br />' + this.series.name + ':  ' + this.y + ' ' + unit;
            }
        },
        plotOptions: {
			line: {
				lineWidth: 3,
				states: {
					hover: {
							lineWidth: 3
					}
				},
				marker: {
					enabled: false,
					states: {
							hover: {
									enabled: true,
									symbol: 'circle',
									radius: 5,
									lineWidth: 1
							}
					}
				}
			}
        },
        legend: {
            enabled: true
        }
    });
  
  $.WeekChart = new Highcharts.Chart({
      chart: {
          renderTo: 'smartweekgraph',
          type: 'column',
          marginRight: 10,
          events: {
              load: function() {
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=week",
                function(data) {
					AddDataToUtilityChart(data,$.WeekChart,switchtype);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Last Week')
        },
        xAxis: {
            type: 'datetime',
            dateTimeLabelFormats: {
                day: '%a'
            },
            tickInterval: 24 * 3600 * 1000
        },
        yAxis: {
            title: {
                text: $.i18n('Energy') + ' (kWh)'
            },
            min: 0
        },
        tooltip: {
            formatter: function() {
					var unit = {
						'Usage': 'Watt',
						'Usage_1': 'kWh',
						'Usage_2': 'kWh',
						'Return_1': 'kWh',
						'Return_2': 'kWh',
						'Gas': 'm3',
						'Water': 'm3'
					}[this.series.name];
                    return $.i18n(Highcharts.dateFormat('%A',this.x)) + ' ' + Highcharts.dateFormat('%Y-%m-%d', this.x) +'<br/>'+ this.series.name + ': ' + this.y + ' ' + unit + '<br/>Total: '+ this.point.stackTotal + ' ' + unit;
            }
        },
        plotOptions: {
            column: {
				stacking: 'normal',
                minPointLength: 4,
                pointPadding: 0.1,
                groupPadding: 0
            }
        },
        legend: {
            enabled: true
        }
    });

  $.MonthChart = new Highcharts.Chart({
      chart: {
          renderTo: 'smartmonthgraph',
          type: 'spline',
          marginRight: 10,
          zoomType: 'xy',
          events: {
              load: function() {
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=month",
                function(data) {
					AddDataToUtilityChart(data,$.MonthChart,switchtype);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Last Month')
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: $.i18n('Usage')
            },
            min: 0
        },
        tooltip: {
            formatter: function() {
					var unit = {
						'Usage': 'Watt',
						'Usage_1': 'kWh',
						'Usage_2': 'kWh',
						'Return_1': 'kWh',
						'Return_2': 'kWh',
						'Total_Usage': 'kWh',
						'Total_Return': 'kWh',
						'Gas': 'm3',
						'Water': 'm3'
					}[this.series.name];
                    return $.i18n(Highcharts.dateFormat('%A',this.x)) + ' ' + Highcharts.dateFormat('%Y-%m-%d', this.x) + '<br/>' + this.series.name + ': ' + this.y.toFixed(2) + ' ' + unit;
            }
        },
        plotOptions: {
			series: {
				point: {
					events: {
						click: function(event) {
							chartPointClickEx(event,ShowSmartLog);
						}
					}
				}
			},
			spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        legend: {
            enabled: true
        }
    });

  $.YearChart = new Highcharts.Chart({
      chart: {
          renderTo: 'smartyeargraph',
          type: 'spline',
          marginRight: 10,
          zoomType: 'xy',
          events: {
              load: function() {
                $.getJSON("json.htm?type=graph&sensor=counter&idx="+id+"&range=year",
                function(data) {
					AddDataToUtilityChart(data,$.YearChart,switchtype);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Last Year')
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: $.i18n('Usage')
            },
            min: 0
        },
        tooltip: {
            formatter: function() {
					var unit = {
						'Usage': 'Watt',
						'Usage_1': 'kWh',
						'Usage_2': 'kWh',
						'Return_1': 'kWh',
						'Return_2': 'kWh',
						'Total_Usage': 'kWh',
						'Total_Return': 'kWh',
						'Gas': 'm3',
						'Water': 'm3'
					}[this.series.name];
                    return $.i18n(Highcharts.dateFormat('%A',this.x)) + ' ' + Highcharts.dateFormat('%Y-%m-%d', this.x) + '<br/>' + this.series.name + ': ' +  this.y.toFixed(2) + ' ' + unit;
            }
        },
        plotOptions: {
			series: {
				point: {
					events: {
						click: function(event) {
							chartPointClickEx(event,ShowSmartLog);
						}
					}
				}
			},
			spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        legend: {
            enabled: true
        }
    });
}

function RefreshUtilities()
{
	clearInterval($.myglobals.refreshTimer);
  var id="";

  $.ajax({
     url: "json.htm?type=devices&filter=utility&used=true&order=Name", 
     async: false, 
     dataType: 'json',
     success: function(data) {
      if (typeof data.result != 'undefined') {
        $.each(data.result, function(i,item){
					id="#utilitycontent #" + item.idx;
					var obj=$(id);
					if (typeof obj != 'undefined') {
						if ($(id + " #name").html()!=item.Name) {
							$(id + " #name").html(item.Name);
						}
						var img="";
						var status="";
						var bigtext="";
						
            if (typeof item.Counter != 'undefined') {
              img='<img src="images/counter.png" height="48">';
              status=item.Counter + ', Today: ' + item.CounterToday;
            }
            else if ((item.Type == "Current")||(item.Type == "Current/Energy")) {
							img='<img src="images/current48.png" height="48">';
              status=item.Data;
            }
            else if (item.Type == "Energy") {
				img='<img src="images/current48.png" height="48">';
				status=item.Data;
            }
            else if (item.Type == "Air Quality") {
				img='<img src="images/air48.png" height="48">';
				status=item.Data + " (" + item.Quality + ")";
				bigtext=item.Data;
            }
            else if (item.SubType == "Soil Moisture") {
				img='<img src="images/moisture48.png" height="48">';
				status=item.Data + " (" + item.Desc + ")";
				bigtext=item.Data;
            }
            else if (item.SubType == "Leaf Wetness") {
				img='<img src="images/leaf48.png" height="48">';
				status=item.Data;
				bigtext=item.Data;
            }
            else if (item.Type == "Lux") {
				img='<img src="images/lux48.png" height="48">';
				status=item.Data;
				bigtext=item.Data;
            }
            else if (item.Type == "Usage") {
				img='<img src="images/current48.png" height="48">';
				status=item.Data;
				bigtext=item.Data;
            }
            else if ((item.Type == "Thermostat")&&(item.SubType=="SetPoint")) {
				img='<img src="images/override.png" height="48">';
				status=item.Data + '\u00B0 C';
				bigtext=item.Data + '\u00B0 C';
            }
            if (typeof item.Usage != 'undefined') {
							status+=", Actual: " + item.Usage;
							bigtext=item.Usage;
            }
            if (typeof item.CounterDeliv != 'undefined') {
				if (item.CounterDeliv!=0) {
					status+='<br>Return: ' + item.CounterDeliv + ', Today: ' + item.CounterDelivToday;
					status+=", Actual: " + item.UsageDeliv;
					if (item.UsageDeliv.charAt(0) != 0) {
						bigtext='-' + item.UsageDeliv;
					}
				}
            }
            
            var nbackcolor="#D4E1EE";
						if (item.HaveTimeout==true) {
							nbackcolor="#DF2D3A";
						}
            var obackcolor=rgb2hex($(id + " #name").css( "background-color" )).toUpperCase();
            if (obackcolor!=nbackcolor) {
							$(id + " #name").css( "background-color", nbackcolor );
            }

						if ($(id + " #img").html()!=img) {
							$(id + " #img").html(img);
						}
						if ($(id + " #status").html()!=status) {
							$(id + " #bigtext").html(bigtext);
							$(id + " #status").html(status);
						}
						if ($(id + " #lastupdate").html()!=item.LastUpdate) {
							$(id + " #lastupdate").html(item.LastUpdate);
						}
					}
        });
      }
     }
  });
	RefreshTimeAndSun();
	$.myglobals.refreshTimer = setInterval(RefreshUtilities, 10000);
}

function ShowUtilities()
{
	clearInterval($.myglobals.refreshTimer);
  $('#modal').show();
  
  var htmlcontent = '';
  var bHaveAddedDevider = false;

  var tophtm=
        '\t<table class="bannav" id="bannav" border="0" cellpadding="0" cellspacing="0" width="100%">\n' +
        '\t<tr>\n' +
		'\t  <td align="left"><div id="timesun" /></td>\n';
  if (window.my_config.userrights==2) {
	tophtm+=
        '\t  <td style="width: 150px;" align="right">\n' +
        '\t    <a class="btnstyle" onclick="AddUtilityDevice();" data-i18n="Add Sensor">Add Sensor</a>\n' +
        '\t  </td>\n';
  }
  tophtm+=
        '\t</tr>\n' +
        '\t</table>\n';
  

  var i=0;
  $.ajax({
     url: "json.htm?type=devices&filter=utility&used=true&order=Name", 
     async: false, 
     dataType: 'json',
     success: function(data) {
      if (typeof data.result != 'undefined') {

				$.FiveMinuteHistoryDays=data["5MinuteHistoryDays"];

        $.each(data.result, function(i,item){
          if (i % 3 == 0)
          {
            //add devider
            if (bHaveAddedDevider == true) {
              //close previous devider
              htmlcontent+='</div>\n';
            }
            htmlcontent+='<div class="row divider">\n';
            bHaveAddedDevider=true;
          }
          
          var xhtm=
                '\t<div class="span4" id="' + item.idx + '">\n' +
                '\t  <section>\n' +
                '\t    <table id="itemtable" border="0" cellpadding="0" cellspacing="0">\n' +
                '\t    <tr>\n';
				if (item.HaveTimeout==false) {
					xhtm+='\t      <td id="name">' + item.Name + '</td>\n';
				}
				else {
					xhtm+='\t      <td id="name" style="background-color: #DF2D3A;">' + item.Name + '</td>\n';
				}
				xhtm+='\t      <td id="bigtext">';
				if ((typeof item.Usage != 'undefined') && (typeof item.UsageDeliv == 'undefined')) {
					xhtm+=item.Usage;
				}
				else if ((typeof item.Usage != 'undefined') && (typeof item.UsageDeliv != 'undefined')) {
					if (item.Usage.charAt(0) != 0) {
						xhtm+=item.Usage;
					}
					if (item.UsageDeliv.charAt(0) != 0) {
						xhtm+='-' + item.UsageDeliv;
					}
				}
				else if (item.Type == "Air Quality") {
				  xhtm+=item.Data;
				}
				else if (item.SubType == "Soil Moisture") {
				  xhtm+=item.Data;
				}
				else if (item.SubType == "Leaf Wetness") {
				  xhtm+=item.Data;
				}
				else if (item.Type == "Lux") {
				  xhtm+=item.Data;
				}
				else if (item.Type == "Usage") {
				  xhtm+=item.Data;
				}
				else if (item.Type == "Thermostat") {
				  xhtm+=item.Data + '\u00B0 C';
				}
				xhtm+='</td>\n';
          xhtm+='\t      <td id="img"><img src="images/';
            var status="";
            if (typeof item.Counter != 'undefined') {
              xhtm+='counter.png" height="48"></td>\n';
              status=item.Counter + ', Today: ' + item.CounterToday;
            }
            else if ((item.Type == "Current")||(item.Type == "Current/Energy")) {
              xhtm+='current48.png" height="48"></td>\n';
              status=item.Data;
            }
            else if (item.Type == "Energy") {
              xhtm+='current48.png" height="48"></td>\n';
              status=item.Data;
            }
            else if (item.Type == "Air Quality") {
              xhtm+='air48.png" height="48"></td>\n';
              status=item.Data + " (" + item.Quality + ")";
            }
            else if (item.SubType == "Soil Moisture") {
              xhtm+='moisture48.png" height="48"></td>\n';
              status=item.Data + " (" + item.Desc + ")";
            }
            else if (item.SubType == "Leaf Wetness") {
              xhtm+='leaf48.png" height="48"></td>\n';
              status=item.Data;
            }
            else if (item.Type == "Lux") {
              xhtm+='lux48.png" height="48"></td>\n';
              status=item.Data;
            }
            else if (item.Type == "Usage") {
              xhtm+='current48.png" height="48"></td>\n';
              status=item.Data;
            }
            else if ((item.Type == "Thermostat")&&(item.SubType=="SetPoint")) {
              xhtm+='override.png" height="48"></td>\n';
              status=item.Data + '\u00B0 C';
            }
            if (typeof item.Usage != 'undefined') {
							status+=", Actual: " + item.Usage;
            }
            if (typeof item.CounterDeliv != 'undefined') {
							if (item.CounterDeliv!=0) {
								status+='<br>Return: ' + item.CounterDeliv + ', Today: ' + item.CounterDelivToday;
								status+=", Actual: " + item.UsageDeliv;

							}
            }
            
						xhtm+=      
                '\t      <td id="status">' + status + '</td>\n' +
                '\t      <td id="lastupdate">' + item.LastUpdate + '</td>\n' +
                '\t      <td id="type">' + item.Type + ', ' + item.SubType + '</td>\n' +
                '\t      <td>';
          if (item.Favorite == 0) {
            xhtm+=      
                  '<img src="images/nofavorite.png" title="' + $.i18n('Add to Dashboard') +'" onclick="MakeFavorite(' + item.idx + ',1);" onmouseover="cursorhand()" onmouseout="cursordefault()">&nbsp;&nbsp;&nbsp;&nbsp;';
          }
          else {
            xhtm+=      
                  '<img src="images/favorite.png" title="' + $.i18n('Remove from Dashboard') +'" onclick="MakeFavorite(' + item.idx + ',0);" onmouseover="cursorhand()" onmouseout="cursordefault()">&nbsp;&nbsp;&nbsp;&nbsp;';
          }

          if (typeof item.Counter != 'undefined') {
			if ((item.Type == "P1 Smart Meter")&&(item.SubType=="Energy")) {
				xhtm+='<a class="btnsmall" onclick="ShowSmartLog(' + item.idx + ',\'' + item.Name + '\', ' + item.SwitchTypeVal + ');" data-i18n="Log">Log</a> ';
			}
			else if ((item.Type == "Value")&&(item.SubType=="Rego 6XX")) {
				xhtm+='<a class="btnsmall" onclick="ShowGenericLog(' + item.idx + ',\'' + item.Name + '\', ' + item.SwitchTypeVal + ');" data-i18n="Log">Log</a> ';
			}
			else {
				xhtm+='<a class="btnsmall" onclick="ShowCounterLog(' + item.idx + ',\'' + item.Name + '\', ' + item.SwitchTypeVal + ');" data-i18n="Log">Log</a> ';
			}
			if (window.my_config.userrights==2) {
				if (item.Type == "P1 Smart Meter") {
					xhtm+=      
								'<a class="btnsmall" onclick="EditUtilityDevice(' + item.idx + ',\'' + item.Name + '\');" data-i18n="Edit">Edit</a> ';
				}
				else {
					xhtm+=      
								'<a class="btnsmall" onclick="EditMeterDevice(' + item.idx + ',\'' + item.Name + '\', ' + item.SwitchTypeVal +');" data-i18n="Edit">Edit</a> ';
				}
			}
          }
		  else if (item.Type == "Air Quality") {
			xhtm+='<a class="btnsmall" onclick="ShowAirQualityLog(' + item.idx + ',\'' + item.Name + '\');" data-i18n="Log">Log</a> ';
			if (window.my_config.userrights==2) {
				xhtm+='<a class="btnsmall" onclick="EditUtilityDevice(' + item.idx + ',\'' + item.Name + '\');" data-i18n="Edit">Edit</a> ';
			}
		  }
		  else if ((item.SubType == "Soil Moisture")||(item.SubType == "Leaf Wetness")) {
			xhtm+='<a class="btnsmall" onclick="ShowGeneralGraph(' + item.idx + ',\'' + item.Name+ '\',' + item.SwitchTypeVal +', \'' + item.SubType + '\');" data-i18n="Log">Log</a> ';
			if (window.my_config.userrights==2) {
				xhtm+='<a class="btnsmall" onclick="EditUtilityDevice(' + item.idx + ',\'' + item.Name + '\');" data-i18n="Edit">Edit</a> ';
			}
		  }
		  else if (item.Type == "Lux") {
			xhtm+='<a class="btnsmall" onclick="ShowLuxLog(' + item.idx + ',\'' + item.Name + '\');" data-i18n="Log">Log</a> ';
			if (window.my_config.userrights==2) {
				xhtm+='<a class="btnsmall" onclick="EditUtilityDevice(' + item.idx + ',\'' + item.Name + '\');" data-i18n="Edit">Edit</a> ';
			}
		  }
		  else if (item.Type == "Usage") {
			xhtm+='<a class="btnsmall" onclick="ShowUsageLog(' + item.idx + ',\'' + item.Name + '\');" data-i18n="Log">Log</a> ';
			if (window.my_config.userrights==2) {
				xhtm+='<a class="btnsmall" onclick="EditUtilityDevice(' + item.idx + ',\'' + item.Name + '\');" data-i18n="Edit">Edit</a> ';
			}
		  }
          else if ((item.Type == "Current")||(item.Type == "Current/Energy")) {
			xhtm+='<a class="btnsmall" onclick="ShowCurrentLog(' + item.idx + ',\'' + item.Name + '\', ' + item.displaytype + ');" data-i18n="Log">Log</a> ';
			if (window.my_config.userrights==2) {
				xhtm+='<a class="btnsmall" onclick="EditUtilityDevice(' + item.idx + ',\'' + item.Name + '\');" data-i18n="Edit">Edit</a> ';
			}
          }
          else if (item.Type == "Energy") {
				xhtm+='<a class="btnsmall" onclick="ShowCounterLog(' + item.idx + ',\'' + item.Name + '\', ' + item.SwitchTypeVal + ');" data-i18n="Log">Log</a> ';
				if (window.my_config.userrights==2) {
					xhtm+='<a class="btnsmall" onclick="EditUtilityDevice(' + item.idx + ',\'' + item.Name + '\');" data-i18n="Edit">Edit</a> ';
				}
          }
          else if ((item.Type == "Thermostat")&&(item.SubType=="SetPoint")) {
				if (window.my_config.userrights==2) {
					xhtm+='<a class="btnsmall" onclick="EditSetPoint(' + item.idx + ',\'' + item.Name + '\', ' + item.SetPoint + ');" data-i18n="Edit">Edit</a> ';
				}
          }
          else {
			if (window.my_config.userrights==2) {
				xhtm+='<a class="btnsmall" onclick="EditUtilityDevice(' + item.idx + ',\'' + item.Name + '\');" data-i18n="Edit">Edit</a> ';
			}
		  }
		  if (window.my_config.userrights==2) {              
			  if (item.Notifications == "true")
				xhtm+='<a class="btnsmall-sel" onclick="ShowNotifications(' + item.idx + ',\'' + item.Name + '\', \'#utilitycontent\', \'ShowUtilities\');" data-i18n="Notifications">Notifications</a>';
			  else
				xhtm+='<a class="btnsmall" onclick="ShowNotifications(' + item.idx + ',\'' + item.Name + '\', \'#utilitycontent\', \'ShowUtilities\');" data-i18n="Notifications">Notifications</a>';
		  }
          xhtm+=      
                '</td>\n' +
                '\t    </tr>\n' +
                '\t    </table>\n' +
                '\t  </section>\n' +
                '\t</div>\n';
          htmlcontent+=xhtm;
        });
      }
     }
  });
  if (bHaveAddedDevider == true) {
    //close previous devider
    htmlcontent+='</div>\n';
  }
  if (htmlcontent == '')
  {
    htmlcontent='<h2>' + $.i18n('No Utility sensors found or added in the system...') + '</h2>';
  }
  $('#modal').hide();
  $('#utilitycontent').html(tophtm+htmlcontent);
  $('#utilitycontent').i18n();

	if (window.my_config.userrights==2) {
		if (window.myglobals.ismobileint==false) {
			$("#utilitycontent .span4").draggable({
					drag: function() {
						clearInterval($.myglobals.refreshTimer);
						$.devIdx=$(this).attr("id");
						$(this).css("z-index", 2);
					},
					revert: true
			});
			$("#utilitycontent .span4").droppable({
					drop: function() {
						var myid=$(this).attr("id");
						$.devIdx.split(' ');
						$.ajax({
							 url: "json.htm?type=command&param=switchdeviceorder&idx1=" + myid + "&idx2=" + $.devIdx,
							 async: false, 
							 dataType: 'json',
							 success: function(data) {
									ShowUtilities();
							 }
						});
					}
			});
		}
	}
	RefreshTimeAndSun();
	$.myglobals.refreshTimer = setInterval(RefreshUtilities, 10000);
  return false;
}

$(document).ready(function() {
    //global var
    $.devIdx=0;
    
    $( "#dialog-editutilitydevice" ).dialog({
          autoOpen: false,
          width: 450,
          height: 160,
          modal: true,
          resizable: false,
          buttons: {
              "Update": function() {
                  var bValid = true;
                  bValid = bValid && checkLength( $("#dialog-editutilitydevice #devicename"), 2, 100 );
                  if ( bValid ) {
                      $( this ).dialog( "close" );
                      $.ajax({
                         url: "json.htm?type=setused&idx=" + $.devIdx + '&name=' + $("#dialog-editutilitydevice #devicename").val() + '&used=true',
                         async: false, 
                         dataType: 'json',
                         success: function(data) {
                            ShowUtilities();
                         }
                      });
                      
                  }
              },
              "Remove Device": function() {
                  var bValid = false;
                  bValid=(confirm($.i18n("Are you sure to remove this Device?"))==true);
                  if ( bValid ) {
                      $( this ).dialog( "close" );
                      $.ajax({
                         url: "json.htm?type=setused&idx=" + $.devIdx + '&name=' + $("#dialog-editutilitydevice #devicename").val() + '&used=false',
                         async: false, 
                         dataType: 'json',
                         success: function(data) {
                            ShowUtilities();
                         }
                      });
                      
                  }
              },
              "Transfer": function() {
                  $( this ).dialog( "close" );
                  TransferDevice($.devIdx,ShowUtilities);
              },
              Cancel: function() {
                  $( this ).dialog( "close" );
              }
          },
          open: function() {
              $(this).keypress(function(e) {
                if (e.keyCode == $.ui.keyCode.ENTER) {
                  e.preventDefault();
                  $(this).parent().find("button:eq(0)").trigger("click");
                }
              });
          },
          close: function() {
            $( this ).dialog( "close" );
          }
    });
    $( "#dialog-editmeterdevice" ).dialog({
          autoOpen: false,
          width: 370,
          height: 200,
          modal: true,
          resizable: false,
          buttons: {
              "Update": function() {
                  var bValid = true;
                  bValid = bValid && checkLength( $("#dialog-editmeterdevice #devicename"), 2, 100 );
                  if ( bValid ) {
                      $( this ).dialog( "close" );
                      $.ajax({
                         url: "json.htm?type=setused&idx=" + $.devIdx + '&name=' + $("#dialog-editmeterdevice #devicename").val() + '&switchtype=' + $("#dialog-editmeterdevice #combometertype").val() + '&used=true',
                         async: false, 
                         dataType: 'json',
                         success: function(data) {
                            ShowUtilities();
                         }
                      });
                      
                  }
              },
              "Remove Device": function() {
                  var bValid = false;
                  bValid=(confirm($.i18n("Are you sure to remove this Device?"))==true);
                  if ( bValid ) {
                      $( this ).dialog( "close" );
                      $.ajax({
                         url: "json.htm?type=setused&idx=" + $.devIdx + '&name=' + $("#dialog-editmeterdevice #devicename").val() + '&used=false',
                         async: false, 
                         dataType: 'json',
                         success: function(data) {
                            ShowUtilities();
                         }
                      });
                      
                  }
              },
              Cancel: function() {
                  $( this ).dialog( "close" );
              }
          },
          open: function() {
              $(this).keypress(function(e) {
                if (e.keyCode == $.ui.keyCode.ENTER) {
                  e.preventDefault();
                  $(this).parent().find("button:eq(0)").trigger("click");
                }
              });
          },
          close: function() {
            $( this ).dialog( "close" );
          }
    });

    $( "#dialog-editsetpointdevice" ).dialog({
          autoOpen: false,
          width: 370,
          height: 230,
          modal: true,
          resizable: false,
          buttons: {
              "Update": function() {
                  var bValid = true;
                  bValid = bValid && checkLength( $("#dialog-editsetpointdevice #devicename"), 2, 100 );
                  if ( bValid ) {
                      $( this ).dialog( "close" );
                      $.ajax({
                         url: "json.htm?type=setused&idx=" + $.devIdx + '&name=' + $("#dialog-editsetpointdevice #devicename").val() + '&setpoint=' + $("#dialog-editsetpointdevice #setpoint").val() + '&used=true',
                         async: false, 
                         dataType: 'json',
                         success: function(data) {
                            ShowUtilities();
                         }
                      });
                      
                  }
              },
              "Remove Device": function() {
                  var bValid = false;
                  bValid=(confirm($.i18n("Are you sure to remove this Device?"))==true);
                  if ( bValid ) {
                      $( this ).dialog( "close" );
                      $.ajax({
                         url: "json.htm?type=setused&idx=" + $.devIdx + '&name=' + $("#dialog-editsetpointdevice #devicename").val() + '&used=false',
                         async: false, 
                         dataType: 'json',
                         success: function(data) {
                            ShowUtilities();
                         }
                      });
                      
                  }
              },
              Cancel: function() {
                  $( this ).dialog( "close" );
              }
          },
          open: function() {
              $(this).keypress(function(e) {
                if (e.keyCode == $.ui.keyCode.ENTER) {
                  e.preventDefault();
                  $(this).parent().find("button:eq(0)").trigger("click");
                }
              });
          },
          close: function() {
            $( this ).dialog( "close" );
          }
    });

  ShowUtilities();
 
} );  
</script>
