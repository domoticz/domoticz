<!DOCTYPE HTML>
<html lang="en-US">
<head>
	
	<meta charset="UTF-8">
	<title>Domoticz Security Panel</title>
		
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="viewport" content="width=540, initial-scale=1.0">

	<link href="css/shared.css" rel="stylesheet" />

	<!-- ToDo: Make theme folder selectable from withoin domoticz -->
	<link href="themes/default/css/style.css" rel="stylesheet" />
	
	<script src="../js/jquery-1.12.0.min.js"></script>
	<script src="../js/i18next-1.8.0.min.js"></script> 
	<script src="../js/domoticz.js"></script>
	<script src="../js/md5.js"></script>
	
	<script src="js/ion.sound.min.js"></script>
	
	<script src="js/securitypanel.js"></script>
	<script type="text/javascript">

		/* global ion, $, MakeDatatableTranslations, SecurityPanel */
		
		// Set up sound
		ion.sound({
			sounds: [
				{name: "arm"},
				{name: "disarm"},
				{name: "key"},
				{name: "wrongcode"}
			],
			// main config
			path: "media/",
			preload: true,
			multiplay: true,
			volume: 0.9
		});
		
		// Set up securitypanel
		var securityPanel = SecurityPanel();
		
		// Setup translation
		function SetLanguageEx(lng) {
			$.i18n.init({
				resGetPath: '/i18n/domoticz-__lng__.json',
				fallbackLng: false,
				getAsync: false,
				debug: false,
				useCookie: false,
				nsseparator: 'aadd',
				keyseparator: 'bbcc',
				lng: lng
			});
			$(".nav").i18n();
			MakeDatatableTranslations();
		}

		// DOM is ready, go go go!
		$(document).ready(function() {

			// Setup i18n
			$.ajax({
				 url: "../json.htm?type=command&param=getlanguage",
				 dataType: 'json',
				 success: function(data) {
					if (typeof data.language != 'undefined') {
						SetLanguageEx(data.language);
					}
					else {
						SetLanguageEx('en');
					}
					
				 	// Entrypoint for "main loop"
				 	securityPanel.Start();

				 },
				 error: function () {

				 	// Entrypoint for "main loop"
				 	securityPanel.Start();
				 	
				 }
			});
			
			// Setup events
			$('li.digit').on('touchstart click', function (e) {
				e.preventDefault();
				
				// Digit
				var 
					target = $(e.target),
					digit = target.data('digit'),
					digitParsed = parseInt(digit, 10);
				if(!isNaN(digitParsed)) {
					securityPanel.AddDigit(digitParsed);
				}
				
			});
			
			$('li.arm').on('touchstart click', function (e) {
				e.preventDefault();
				
				// Digit
				var 
					target = $(e.target),
					secstatus = target.data('secstatus'),
					secstatusParsed = parseInt(secstatus, 10);
				if(!isNaN(secstatusParsed)) {
					securityPanel.SetSecStatus(secstatusParsed);
				}
				
			});

			$('li.cancel').on('touchstart click', function (e) {
				e.preventDefault();
				
				// Update immediately
				securityPanel.Beep('out');
				securityPanel.ResetHeartbeat(0);
			});
			
		});

	</script>
</head>
<body>
	<div id="main">
		<div class="main-border">
			<div id="keypad">
				<div class="keypad-header">
					<div class="title fullscreen"><p>Domoticz Security Panel</p></div>
				</div>
				<form name="keypadinput">
					<input type="text" id="digitdisplay" value="" name="digitdisplay" disabled="disabled"/>
					<ul class="keypad-keys">
						<li class="digit" data-digit="1">1</li>
						<li class="digit" data-digit="2">2</li>
						<li class="digit" data-digit="3">3</li>
						<li class="arm disarm" data-secstatus="0">Disarm</li>
					</ul>
					<ul class="keypad-keys">
						<li class="digit" data-digit="4">4</li>
						<li class="digit" data-digit="5">5</li>
						<li class="digit" data-digit="6">6</li>
						<li class="arm" data-secstatus="1">Arm Home</li>
					</ul>
					<ul class="keypad-keys">
						<li class="digit" data-digit="7">7</li>
						<li class="digit" data-digit="8">8</li>
						<li class="digit" data-digit="9">9</li>
						<li class="arm" data-secstatus="2">Arm Away</li>
					</ul>
					<ul class="keypad-keys">
						<li class="hidden"></li>
						<li class="digit" data-digit="0">0</li>
						<li class="hidden"></li>
						<li class="arm cancel">Cancel</li>
					</ul>
				</form>
			</div>
		</div>
	</div>
</body>
</html>
